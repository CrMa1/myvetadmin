{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///C:/Proyectos/Veterinarios/myvetadmin/lib/stripe.js"],"sourcesContent":["import \"server-only\"\r\nimport Stripe from \"stripe\"\r\n\r\nif (!process.env.STRIPE_SECRET_KEY) {\r\n  throw new Error(\"STRIPE_SECRET_KEY is not set\")\r\n}\r\n\r\nexport const stripe = new Stripe(process.env.STRIPE_SECRET_KEY, {\r\n  apiVersion: \"2024-11-20.acacia\",\r\n})\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,iBAAiB,EAAE;IAClC,MAAM,IAAI,MAAM;AAClB;AAEO,MAAM,SAAS,IAAI,mKAAM,CAAC,QAAQ,GAAG,CAAC,iBAAiB,EAAE;IAC9D,YAAY;AACd","debugId":null}},
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///C:/Proyectos/Veterinarios/myvetadmin/lib/products.js"],"sourcesContent":["// Catálogo de productos para Stripe Checkout\r\n// Este archivo define los planes disponibles para compra\r\n\r\nexport const PRODUCTS = [\r\n  {\r\n    id: \"price_1ST7U31LGdPqIkO0bpfkijHK\",\r\n    planId: 1, // Referencia al ID en la base de datos\r\n    name: \"Plan Básico - Mensual\",\r\n    billingCycle: \"monthly\",\r\n    description: \"Perfecto para clínicas pequeñas\",\r\n    priceInCents: 29900, // $299.00 MXN\r\n  },\r\n  {\r\n    id: \"price_1ST9mo1LGdPqIkO00SK37B7p\",\r\n    planId: 1,\r\n    name: \"Plan Básico - Anual\",\r\n    billingCycle: \"yearly\",\r\n    description: \"Ahorra 17% pagando anualmente\",\r\n    priceInCents: 299000, // $2,990.00 MXN\r\n  },\r\n  {\r\n    id: \"price_1ST9nG1LGdPqIkO0qwjJDoQg\",\r\n    planId: 2,\r\n    name: \"Plan Profesional - Mensual\",\r\n    billingCycle: \"monthly\",\r\n    description: \"Ideal para clínicas en crecimiento\",\r\n    priceInCents: 59900, // $599.00 MXN\r\n  },\r\n  {\r\n    id: \"plan-profesional-yearly\",\r\n    planId: 2,\r\n    name: \"Plan Profesional - Anual\",\r\n    billingCycle: \"yearly\",\r\n    description: \"Ahorra 17% pagando anualmente\",\r\n    priceInCents: 599000, // $5,990.00 MXN\r\n  },\r\n  {\r\n    id: \"plan-empresarial-monthly\",\r\n    planId: 3,\r\n    name: \"Plan Empresarial - Mensual\",\r\n    billingCycle: \"monthly\",\r\n    description: \"La solución completa para grandes clínicas\",\r\n    priceInCents: 119900, // $1,199.00 MXN\r\n  },\r\n  {\r\n    id: \"plan-empresarial-yearly\",\r\n    planId: 3,\r\n    name: \"Plan Empresarial - Anual\",\r\n    billingCycle: \"yearly\",\r\n    description: \"Ahorra 17% pagando anualmente\",\r\n    priceInCents: 1199000, // $11,990.00 MXN\r\n  },\r\n]\r\n\r\nexport function getProductById(id) {\r\n  return PRODUCTS.find((p) => p.id === id)\r\n}\r\n\r\nexport function getProductsByPlanId(planId) {\r\n  return PRODUCTS.filter((p) => p.planId === planId)\r\n}\r\n"],"names":[],"mappings":"AAAA,6CAA6C;AAC7C,yDAAyD;;;;;;;;;AAElD,MAAM,WAAW;IACtB;QACE,IAAI;QACJ,QAAQ;QACR,MAAM;QACN,cAAc;QACd,aAAa;QACb,cAAc;IAChB;IACA;QACE,IAAI;QACJ,QAAQ;QACR,MAAM;QACN,cAAc;QACd,aAAa;QACb,cAAc;IAChB;IACA;QACE,IAAI;QACJ,QAAQ;QACR,MAAM;QACN,cAAc;QACd,aAAa;QACb,cAAc;IAChB;IACA;QACE,IAAI;QACJ,QAAQ;QACR,MAAM;QACN,cAAc;QACd,aAAa;QACb,cAAc;IAChB;IACA;QACE,IAAI;QACJ,QAAQ;QACR,MAAM;QACN,cAAc;QACd,aAAa;QACb,cAAc;IAChB;IACA;QACE,IAAI;QACJ,QAAQ;QACR,MAAM;QACN,cAAc;QACd,aAAa;QACb,cAAc;IAChB;CACD;AAEM,SAAS,eAAe,EAAE;IAC/B,OAAO,SAAS,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;AACvC;AAEO,SAAS,oBAAoB,MAAM;IACxC,OAAO,SAAS,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,KAAK;AAC7C","debugId":null}},
    {"offset": {"line": 170, "column": 0}, "map": {"version":3,"sources":["file:///C:/Proyectos/Veterinarios/myvetadmin/app/api/stripe/create-checkout/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\"\r\nimport { stripe } from \"@/lib/stripe\"\r\nimport { getProductById } from \"@/lib/products\"\r\n\r\nexport async function POST(request) {\r\n  try {\r\n    const { productId, userData } = await request.json()\r\n\r\n    console.log(\"[v0] Creating checkout session for product:\", productId)\r\n    console.log(\"[v0] User data TODO:\", userData)\r\n    console.log(\"[v0] User data:\", { email: userData.email, name: userData.firstName })\r\n\r\n    const product = getProductById(productId)\r\n    if (!product) {\r\n      return NextResponse.json({ error: \"Producto no encontrado\" }, { status: 404 })\r\n    }\r\n\r\n    // Create or retrieve Stripe customer\r\n    let customer\r\n    const existingCustomers = await stripe.customers.list({\r\n      email: userData.email,\r\n      limit: 1,\r\n    })\r\n\r\n    if (existingCustomers.data.length > 0) {\r\n      customer = existingCustomers.data[0]\r\n      console.log(\"[v0] Existing customer found:\", customer.id)\r\n    } else {\r\n      console.log(\"[v0] New customer creating:\", userData)\r\n      customer = await stripe.customers.create({\r\n        email: userData.email,\r\n        name: `${userData.firstName} ${userData.lastName}`,\r\n        phone: userData.phone,\r\n        metadata: {\r\n          userId: userData.userId || \"pending\",\r\n        },\r\n      })\r\n      console.log(\"[v0] New customer created:\", customer.id)\r\n    }\r\n\r\n    // Create checkout session for subscription\r\n    const session = await stripe.checkout.sessions.create({\r\n      customer: customer.id,\r\n      ui_mode: \"embedded\",\r\n      redirect_on_completion: \"never\",\r\n      line_items: [\r\n        {\r\n          price_data: {\r\n            currency: \"mxn\",\r\n            product_data: {\r\n              name: product.name,\r\n              description: product.description,\r\n            },\r\n            unit_amount: product.priceInCents,\r\n            recurring: product.billingCycle === \"yearly\" ? { interval: \"year\" } : { interval: \"month\" },\r\n          },\r\n          quantity: 1,\r\n        },\r\n      ],\r\n      mode: \"subscription\",\r\n      metadata: {\r\n        productId: product.id,\r\n        planId: product.planId.toString(),\r\n        billingCycle: product.billingCycle,\r\n        userId: userData.userId || \"pending\",\r\n      },\r\n    })\r\n\r\n    console.log(\"[v0] Checkout session created:\", session.id)\r\n\r\n    return NextResponse.json({ clientSecret: session.client_secret })\r\n  } catch (error) {\r\n    console.error(\"[v0] Error creating checkout session:\", error)\r\n    return NextResponse.json({ error: \"Error al crear sesión de pago\" }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAElD,QAAQ,GAAG,CAAC,+CAA+C;QAC3D,QAAQ,GAAG,CAAC,wBAAwB;QACpC,QAAQ,GAAG,CAAC,mBAAmB;YAAE,OAAO,SAAS,KAAK;YAAE,MAAM,SAAS,SAAS;QAAC;QAEjF,MAAM,UAAU,IAAA,mIAAc,EAAC;QAC/B,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAC9E;QAEA,qCAAqC;QACrC,IAAI;QACJ,MAAM,oBAAoB,MAAM,yHAAM,CAAC,SAAS,CAAC,IAAI,CAAC;YACpD,OAAO,SAAS,KAAK;YACrB,OAAO;QACT;QAEA,IAAI,kBAAkB,IAAI,CAAC,MAAM,GAAG,GAAG;YACrC,WAAW,kBAAkB,IAAI,CAAC,EAAE;YACpC,QAAQ,GAAG,CAAC,iCAAiC,SAAS,EAAE;QAC1D,OAAO;YACL,QAAQ,GAAG,CAAC,+BAA+B;YAC3C,WAAW,MAAM,yHAAM,CAAC,SAAS,CAAC,MAAM,CAAC;gBACvC,OAAO,SAAS,KAAK;gBACrB,MAAM,GAAG,SAAS,SAAS,CAAC,CAAC,EAAE,SAAS,QAAQ,EAAE;gBAClD,OAAO,SAAS,KAAK;gBACrB,UAAU;oBACR,QAAQ,SAAS,MAAM,IAAI;gBAC7B;YACF;YACA,QAAQ,GAAG,CAAC,8BAA8B,SAAS,EAAE;QACvD;QAEA,2CAA2C;QAC3C,MAAM,UAAU,MAAM,yHAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC;YACpD,UAAU,SAAS,EAAE;YACrB,SAAS;YACT,wBAAwB;YACxB,YAAY;gBACV;oBACE,YAAY;wBACV,UAAU;wBACV,cAAc;4BACZ,MAAM,QAAQ,IAAI;4BAClB,aAAa,QAAQ,WAAW;wBAClC;wBACA,aAAa,QAAQ,YAAY;wBACjC,WAAW,QAAQ,YAAY,KAAK,WAAW;4BAAE,UAAU;wBAAO,IAAI;4BAAE,UAAU;wBAAQ;oBAC5F;oBACA,UAAU;gBACZ;aACD;YACD,MAAM;YACN,UAAU;gBACR,WAAW,QAAQ,EAAE;gBACrB,QAAQ,QAAQ,MAAM,CAAC,QAAQ;gBAC/B,cAAc,QAAQ,YAAY;gBAClC,QAAQ,SAAS,MAAM,IAAI;YAC7B;QACF;QAEA,QAAQ,GAAG,CAAC,kCAAkC,QAAQ,EAAE;QAExD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,cAAc,QAAQ,aAAa;QAAC;IACjE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yCAAyC;QACvD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgC,GAAG;YAAE,QAAQ;QAAI;IACrF;AACF","debugId":null}}]
}