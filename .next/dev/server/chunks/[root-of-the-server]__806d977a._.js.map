{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/Proyectos/Veterinarios/myvetadmin/lib/db.js"],"sourcesContent":["import mysql from \"mysql2/promise\"\n\n\n// Configuración de la conexión a la base de datos\nconst dbConfig = {\n  host: process.env.DB_HOST || \"174.136.31.150\",\n  user: process.env.DB_USER || \"mavishop_myvetadmin\",\n  password: process.env.DB_PASSWORD || \"KDZ-2y_O#cmI^v7r\",\n  database: process.env.DB_NAME || \"mavishop_myvetadmin\",\n  waitForConnections: true,\n  connectionLimit: 10,\n  queueLimit: 0,\n  enableKeepAlive: true,\n  keepAliveInitialDelay: 0,\n}\n\n// Pool de conexiones para mejor rendimiento\nlet pool\n\nexport async function getConnection() {\n  if (!pool) {\n    pool = mysql.createPool(dbConfig)\n  }\n  return pool\n}\n\nexport async function query(sql, params) {\n  //console.log(\"[v0] Query params:\", params)\n  \n  const connection = await getConnection()\n  try {\n    const [results] = await connection.execute(sql, params)\n    //console.log(\"[v0] Query successful, rows returned:\", Array.isArray(results) ? results.length : \"single result\")\n    return results\n  } catch (error) {\n    console.error(\"[v0] Database query error - Full details:\")\n    console.error(\"[v0] Query:\", sql)\n    console.error(\"[v0] Params:\", params)\n    console.error(\"[v0] Error message:\", error.message)\n    console.error(\"[v0] Error code:\", error.code)\n    console.error(\"[v0] Error sqlState:\", error.sqlState)\n    console.error(\"[v0] Error:\", error)\n    throw error\n  }\n}\n\nexport default { getConnection, query }\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAGA,kDAAkD;AAClD,MAAM,WAAW;IACf,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;IACrC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;IACjC,oBAAoB;IACpB,iBAAiB;IACjB,YAAY;IACZ,iBAAiB;IACjB,uBAAuB;AACzB;AAEA,4CAA4C;AAC5C,IAAI;AAEG,eAAe;IACpB,IAAI,CAAC,MAAM;QACT,OAAO,8IAAK,CAAC,UAAU,CAAC;IAC1B;IACA,OAAO;AACT;AAEO,eAAe,MAAM,GAAG,EAAE,MAAM;IACrC,2CAA2C;IAE3C,MAAM,aAAa,MAAM;IACzB,IAAI;QACF,MAAM,CAAC,QAAQ,GAAG,MAAM,WAAW,OAAO,CAAC,KAAK;QAChD,iHAAiH;QACjH,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC;QACd,QAAQ,KAAK,CAAC,eAAe;QAC7B,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,QAAQ,KAAK,CAAC,uBAAuB,MAAM,OAAO;QAClD,QAAQ,KAAK,CAAC,oBAAoB,MAAM,IAAI;QAC5C,QAAQ,KAAK,CAAC,wBAAwB,MAAM,QAAQ;QACpD,QAAQ,KAAK,CAAC,eAAe;QAC7B,MAAM;IACR;AACF;uCAEe;IAAE;IAAe;AAAM","debugId":null}},
    {"offset": {"line": 168, "column": 0}, "map": {"version":3,"sources":["file:///C:/Proyectos/Veterinarios/myvetadmin/app/api/notifications/route.js"],"sourcesContent":["import { query } from \"@/lib/db\"\r\n\r\nexport async function GET(request) {\r\n  try {\r\n    const { searchParams } = new URL(request.url)\r\n    const userId = searchParams.get(\"userId\")\r\n    const clinicId = searchParams.get(\"clinicId\")\r\n\r\n    if (!userId || !clinicId) {\r\n      return Response.json({ success: false, error: \"Missing required parameters\" }, { status: 400 })\r\n    }\r\n\r\n    console.log(\"[v0] Fetching upcoming consultations for notifications:\", { userId, clinicId })\r\n\r\n    const upcomingConsultations = await query(\r\n      `SELECT \r\n        c.id,\r\n        c.consultation_date as date,\r\n        CONCAT(cl.first_name, ' ', cl.last_name) as ownerName,\r\n        p.name as patientName,\r\n        c.reason,\r\n        c.status,\r\n        u.name as veterinarian\r\n      FROM consultations c\r\n      INNER JOIN patients p ON c.patient_id = p.id\r\n      INNER JOIN clients cl ON p.client_id = cl.id\r\n      INNER JOIN staff u ON c.veterinarian_id = u.id\r\n      WHERE c.user_id = ? \r\n        AND c.clinic_id = ?\r\n        AND c.consultation_date >= CURDATE()\r\n        AND c.status != 'Completada'\r\n      ORDER BY c.consultation_date ASC, c.id ASC\r\n      LIMIT 10`,\r\n      [userId, clinicId],\r\n    )\r\n\r\n    console.log(\"[v0] Found upcoming consultations:\", upcomingConsultations.length)\r\n\r\n    return Response.json({\r\n      success: true,\r\n      data: upcomingConsultations || [],\r\n    })\r\n  } catch (error) {\r\n    console.error(\"[v0] Error fetching notifications:\", error)\r\n    return Response.json({ success: false, error: error.message }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,IAAI,OAAO;IAC/B,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,SAAS,aAAa,GAAG,CAAC;QAChC,MAAM,WAAW,aAAa,GAAG,CAAC;QAElC,IAAI,CAAC,UAAU,CAAC,UAAU;YACxB,OAAO,SAAS,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QAC/F;QAEA,QAAQ,GAAG,CAAC,2DAA2D;YAAE;YAAQ;QAAS;QAE1F,MAAM,wBAAwB,MAAM,IAAA,oHAAK,EACvC,CAAC;;;;;;;;;;;;;;;;;cAiBO,CAAC,EACT;YAAC;YAAQ;SAAS;QAGpB,QAAQ,GAAG,CAAC,sCAAsC,sBAAsB,MAAM;QAE9E,OAAO,SAAS,IAAI,CAAC;YACnB,SAAS;YACT,MAAM,yBAAyB,EAAE;QACnC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;QACpD,OAAO,SAAS,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACF","debugId":null}}]
}