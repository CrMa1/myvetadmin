{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///C:/Proyectos/Veterinarios/myvetadmin/lib/db.js"],"sourcesContent":["import mysql from \"mysql2/promise\"\n\n\n// Configuración de la conexión a la base de datos\nconst dbConfig = {\n  host: process.env.DB_HOST || \"174.136.31.150\",\n  user: process.env.DB_USER || \"mavishop_myvetadmin\",\n  password: process.env.DB_PASSWORD || \"KDZ-2y_O#cmI^v7r\",\n  database: process.env.DB_NAME || \"mavishop_myvetadmin\",\n  waitForConnections: true,\n  connectionLimit: 10,\n  queueLimit: 0,\n  enableKeepAlive: true,\n  keepAliveInitialDelay: 0,\n}\n\n// Pool de conexiones para mejor rendimiento\nlet pool\n\nexport async function getConnection() {\n  if (!pool) {\n    pool = mysql.createPool(dbConfig)\n  }\n  return pool\n}\n\nexport async function query(sql, params) {\n  //console.log(\"[v0] Query params:\", params)\n  \n  const connection = await getConnection()\n  try {\n    const [results] = await connection.execute(sql, params)\n    //console.log(\"[v0] Query successful, rows returned:\", Array.isArray(results) ? results.length : \"single result\")\n    return results\n  } catch (error) {\n    console.error(\"[v0] Database query error - Full details:\")\n    console.error(\"[v0] Query:\", sql)\n    console.error(\"[v0] Params:\", params)\n    console.error(\"[v0] Error message:\", error.message)\n    console.error(\"[v0] Error code:\", error.code)\n    console.error(\"[v0] Error sqlState:\", error.sqlState)\n    console.error(\"[v0] Error:\", error)\n    throw error\n  }\n}\n\nexport default { getConnection, query }\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAGA,kDAAkD;AAClD,MAAM,WAAW;IACf,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;IACrC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;IACjC,oBAAoB;IACpB,iBAAiB;IACjB,YAAY;IACZ,iBAAiB;IACjB,uBAAuB;AACzB;AAEA,4CAA4C;AAC5C,IAAI;AAEG,eAAe;IACpB,IAAI,CAAC,MAAM;QACT,OAAO,8IAAK,CAAC,UAAU,CAAC;IAC1B;IACA,OAAO;AACT;AAEO,eAAe,MAAM,GAAG,EAAE,MAAM;IACrC,2CAA2C;IAE3C,MAAM,aAAa,MAAM;IACzB,IAAI;QACF,MAAM,CAAC,QAAQ,GAAG,MAAM,WAAW,OAAO,CAAC,KAAK;QAChD,iHAAiH;QACjH,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC;QACd,QAAQ,KAAK,CAAC,eAAe;QAC7B,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,QAAQ,KAAK,CAAC,uBAAuB,MAAM,OAAO;QAClD,QAAQ,KAAK,CAAC,oBAAoB,MAAM,IAAI;QAC5C,QAAQ,KAAK,CAAC,wBAAwB,MAAM,QAAQ;QACpD,QAAQ,KAAK,CAAC,eAAe;QAC7B,MAAM;IACR;AACF;uCAEe;IAAE;IAAe;AAAM","debugId":null}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///C:/Proyectos/Veterinarios/myvetadmin/app/api/staff/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { query } from \"@/lib/db\"\n\nexport async function GET(request) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const userId = searchParams.get(\"userId\")\n    const clinicId = searchParams.get(\"clinicId\")\n\n    if (!userId || !clinicId) {\n      return NextResponse.json({ success: false, error: \"userId y clinicId son requeridos\" }, { status: 400 })\n    }\n\n    const staff = await query(\n      `SELECT \n        s.id, \n        s.name as firstName, \n        s.last_name as lastName, \n        s.position_id as positionId,\n        p.name as position, \n        s.email, \n        s.phone, \n        s.salary, \n        s.license, \n        s.hire_date as hireDate,\n        s.created_at as createdAt\n       FROM staff s\n       LEFT JOIN positions p ON s.position_id = p.id\n       WHERE s.user_id = ? AND s.clinic_id = ? \n       ORDER BY s.created_at DESC`,\n      [userId, clinicId],\n    )\n\n    return NextResponse.json({ success: true, data: staff })\n  } catch (error) {\n    console.error(\"Get staff error:\", error)\n    return NextResponse.json({ success: false, error: \"Error al obtener personal\" }, { status: 500 })\n  }\n}\n\nexport async function POST(request) {\n  try {\n    const body = await request.json()\n\n    if (!body.userId || !body.clinicId) {\n      return NextResponse.json({ success: false, error: \"userId y clinicId son requeridos\" }, { status: 400 })\n    }\n\n     // Verificar si el teléfono ya existe en este consultorio\n    const existingPhone = await query(\n      \"SELECT id FROM staff WHERE phone = ? AND clinic_id = ?\",\n      [body.phone, body.clinicId]\n    )\n\n    if (existingPhone.length > 0) {\n      return Response.json({ success: false, error: \"El teléfono ya está registrado\" }, { status: 400 })\n    }\n\n    // Si se proporciona email, verificar que no exista\n    if (body.email) {\n      const existingEmail = await query(\n        \"SELECT id FROM staff WHERE email = ? AND clinic_id = ?\",\n        [body.email, body.clinicId]\n      )\n\n      if (existingEmail.length > 0) {\n        return Response.json({ success: false, error: \"El email ya está registrado\" }, { status: 400 })\n      }\n    }\n\n    const result = await query(\n      `INSERT INTO staff (user_id, clinic_id, name, last_name, position_id, email, phone, salary, license, hire_date)\n       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,\n      [\n        body.userId,\n        body.clinicId,\n        body.name,\n        body.lastName,\n        body.positionId,\n        body.email || null,\n        body.phone || null,\n        body.salary || null,\n        body.license || null,\n        body.hireDate || new Date().toISOString().split(\"T\")[0],\n      ],\n    )\n\n    const newStaff = await query(\n      `SELECT \n        s.id, \n        s.name, \n        s.last_name as lastName, \n        s.position_id as positionId,\n        p.name as position, \n        s.email, \n        s.phone, \n        s.salary, \n        s.license, \n        s.hire_date as hireDate \n       FROM staff s\n       LEFT JOIN positions p ON s.position_id = p.id\n       WHERE s.id = ?`,\n      [result.insertId],\n    )\n\n    return NextResponse.json({ success: true, data: newStaff[0] })\n  } catch (error) {\n    console.error(\"Create staff error:\", error)\n    return NextResponse.json({ success: false, error: \"Error al crear empleado\" }, { status: 500 })\n  }\n}\n\nexport async function PUT(request) {\n  try {\n    const body = await request.json()\n\n    if (!body.userId || !body.clinicId) {\n      return NextResponse.json({ success: false, error: \"userId y clinicId son requeridos\" }, { status: 400 })\n    }\n\n    await query(\n      `UPDATE staff \n       SET name = ?, last_name = ?, position_id = ?, email = ?, \n           phone = ?, salary = ?, license = ?\n       WHERE id = ? AND user_id = ? AND clinic_id = ?`,\n      [\n        body.name,\n        body.lastName,\n        body.positionId,\n        body.email || null,\n        body.phone || null,\n        body.salary || null,\n        body.license || null,\n        body.id,\n        body.userId,\n        body.clinicId,\n      ],\n    )\n\n    const updatedStaff = await query(\n      `SELECT \n        s.id, \n        s.name, \n        s.last_name as lastName, \n        s.position_id as positionId,\n        p.name as position, \n        s.email, \n        s.phone, \n        s.salary, \n        s.license, \n        s.hire_date as hireDate \n       FROM staff s\n       LEFT JOIN positions p ON s.position_id = p.id\n       WHERE s.id = ? AND s.user_id = ? AND s.clinic_id = ?`,\n      [body.id, body.userId, body.clinicId],\n    )\n\n    if (updatedStaff.length === 0) {\n      return NextResponse.json({ success: false, error: \"Empleado no encontrado\" }, { status: 404 })\n    }\n\n    return NextResponse.json({ success: true, data: updatedStaff[0] })\n  } catch (error) {\n    console.error(\"Update staff error:\", error)\n    return NextResponse.json({ success: false, error: \"Error al actualizar empleado\" }, { status: 500 })\n  }\n}\n\nexport async function DELETE(request) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const id = searchParams.get(\"id\")\n    const userId = searchParams.get(\"userId\")\n    const clinicId = searchParams.get(\"clinicId\")\n\n    if (!userId || !clinicId) {\n      return NextResponse.json({ success: false, error: \"userId y clinicId son requeridos\" }, { status: 400 })\n    }\n\n    const result = await query(\"DELETE FROM staff WHERE id = ? AND user_id = ? AND clinic_id = ?\", [\n      id,\n      userId,\n      clinicId,\n    ])\n\n    if (result.affectedRows === 0) {\n      return NextResponse.json({ success: false, error: \"Empleado no encontrado\" }, { status: 404 })\n    }\n\n    return NextResponse.json({ success: true, message: \"Empleado eliminado correctamente\" })\n  } catch (error) {\n    console.error(\"Delete staff error:\", error)\n    return NextResponse.json({ success: false, error: \"Error al eliminar empleado\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}