{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///C:/Proyectos/Veterinarios/myvetadmin/lib/db.js"],"sourcesContent":["import mysql from \"mysql2/promise\"\n\n\n// Configuración de la conexión a la base de datos\nconst dbConfig = {\n  host: process.env.DB_HOST || \"174.136.31.150\",\n  user: process.env.DB_USER || \"mavishop_myvetadmin\",\n  password: process.env.DB_PASSWORD || \"KDZ-2y_O#cmI^v7r\",\n  database: process.env.DB_NAME || \"mavishop_myvetadmin\",\n  waitForConnections: true,\n  connectionLimit: 10,\n  queueLimit: 0,\n  enableKeepAlive: true,\n  keepAliveInitialDelay: 0,\n}\n\n// Pool de conexiones para mejor rendimiento\nlet pool\n\nexport async function getConnection() {\n  if (!pool) {\n    pool = mysql.createPool(dbConfig)\n  }\n  return pool\n}\n\nexport async function query(sql, params) {\n  //console.log(\"[v0] Query params:\", params)\n  \n  const connection = await getConnection()\n  try {\n    const [results] = await connection.execute(sql, params)\n    //console.log(\"[v0] Query successful, rows returned:\", Array.isArray(results) ? results.length : \"single result\")\n    return results\n  } catch (error) {\n    //console.error(\"[v0] Database query error - Full details:\")\n    //console.error(\"[v0] Query:\", sql)\n    //console.error(\"[v0] Params:\", params)\n    //console.error(\"[v0] Error message:\", error.message)\n    //console.error(\"[v0] Error code:\", error.code)\n    //console.error(\"[v0] Error sqlState:\", error.sqlState)\n    //console.error(\"[v0] Error:\", error)\n    throw error\n  }\n}\n\nexport default { getConnection, query }\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAGA,kDAAkD;AAClD,MAAM,WAAW;IACf,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;IACrC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;IACjC,oBAAoB;IACpB,iBAAiB;IACjB,YAAY;IACZ,iBAAiB;IACjB,uBAAuB;AACzB;AAEA,4CAA4C;AAC5C,IAAI;AAEG,eAAe;IACpB,IAAI,CAAC,MAAM;QACT,OAAO,8IAAK,CAAC,UAAU,CAAC;IAC1B;IACA,OAAO;AACT;AAEO,eAAe,MAAM,GAAG,EAAE,MAAM;IACrC,2CAA2C;IAE3C,MAAM,aAAa,MAAM;IACzB,IAAI;QACF,MAAM,CAAC,QAAQ,GAAG,MAAM,WAAW,OAAO,CAAC,KAAK;QAChD,iHAAiH;QACjH,OAAO;IACT,EAAE,OAAO,OAAO;QACd,4DAA4D;QAC5D,mCAAmC;QACnC,uCAAuC;QACvC,qDAAqD;QACrD,+CAA+C;QAC/C,uDAAuD;QACvD,qCAAqC;QACrC,MAAM;IACR;AACF;uCAEe;IAAE;IAAe;AAAM","debugId":null}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///C:/Proyectos/Veterinarios/myvetadmin/app/api/auth/register/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { query } from \"@/lib/db\"\nimport bcrypt from \"bcryptjs\"\n\nexport async function POST(request) {\n  try {\n    const body = await request.json()\n\n    console.log(\"[v0] Register request received:\", {\n      email: body.email,\n      phone: body.phone,\n      hasClinicData: !!body.clinicName,\n    })\n\n    if (!body.clinicName || !body.clinicAddress || !body.clinicPhone) {\n      return NextResponse.json(\n        { success: false, error: \"Todos los datos del consultorio son requeridos\" },\n        { status: 400 },\n      )\n    }\n\n    const existingEmail = await query(\"SELECT id FROM users WHERE email = ?\", [body.email])\n    if (existingEmail.length > 0) {\n      return NextResponse.json({ success: false, error: \"El correo electrónico ya está registrado\" }, { status: 400 })\n    }\n\n    const existingPhone = await query(\"SELECT id FROM users WHERE phone = ?\", [body.phone])\n    if (existingPhone.length > 0) {\n      return NextResponse.json({ success: false, error: \"El número de teléfono ya está registrado\" }, { status: 400 })\n    }\n\n    const hashedPassword = await bcrypt.hash(body.password, 10)\n\n    const userResult = await query(\n      `INSERT INTO users (name, email, password, role, phone) \n       VALUES (?, ?, ?, ?, ?)`,\n      [\n        `${body.firstName || \"\"} ${body.lastName || \"\"}`.trim() || body.name,\n        body.email,\n        hashedPassword,\n        body.role || \"admin\",\n        body.phone || \"\",\n      ],\n    )\n\n    const userId = userResult.insertId\n    console.log(\"[v0] User created with ID:\", userId)\n\n    const clinicResult = await query(\n      `INSERT INTO clinics (user_id, name, address, phone, email, city, state, postal_code) \n       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,\n      [\n        userId,\n        body.clinicName,\n        body.clinicAddress,\n        body.clinicPhone,\n        body.clinicEmail || body.email,\n        body.clinicCity || \"\",\n        body.clinicState || \"\",\n        body.clinicPostalCode || \"\",\n      ],\n    )\n\n    console.log(\"[v0] Clinic created with ID:\", clinicResult.insertId)\n\n    const newUsers = await query(\"SELECT id, name, email, role, phone, created_at FROM users WHERE id = ?\", [userId])\n    const newClinics = await query(\"SELECT * FROM clinics WHERE id = ?\", [clinicResult.insertId])\n\n    return NextResponse.json({\n      success: true,\n      data: {\n        ...newUsers[0],\n        clinic: newClinics[0],\n      },\n      message: \"Registro exitoso\",\n    })\n  } catch (error) {\n    console.error(\"[v0] Register error:\", error)\n    return NextResponse.json({ success: false, error: \"Error al registrar usuario\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,QAAQ,GAAG,CAAC,mCAAmC;YAC7C,OAAO,KAAK,KAAK;YACjB,OAAO,KAAK,KAAK;YACjB,eAAe,CAAC,CAAC,KAAK,UAAU;QAClC;QAEA,IAAI,CAAC,KAAK,UAAU,IAAI,CAAC,KAAK,aAAa,IAAI,CAAC,KAAK,WAAW,EAAE;YAChE,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAiD,GAC1E;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,gBAAgB,MAAM,IAAA,oHAAK,EAAC,wCAAwC;YAAC,KAAK,KAAK;SAAC;QACtF,IAAI,cAAc,MAAM,GAAG,GAAG;YAC5B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAA2C,GAAG;gBAAE,QAAQ;YAAI;QAChH;QAEA,MAAM,gBAAgB,MAAM,IAAA,oHAAK,EAAC,wCAAwC;YAAC,KAAK,KAAK;SAAC;QACtF,IAAI,cAAc,MAAM,GAAG,GAAG;YAC5B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAA2C,GAAG;gBAAE,QAAQ;YAAI;QAChH;QAEA,MAAM,iBAAiB,MAAM,8IAAM,CAAC,IAAI,CAAC,KAAK,QAAQ,EAAE;QAExD,MAAM,aAAa,MAAM,IAAA,oHAAK,EAC5B,CAAC;6BACsB,CAAC,EACxB;YACE,GAAG,KAAK,SAAS,IAAI,GAAG,CAAC,EAAE,KAAK,QAAQ,IAAI,IAAI,CAAC,IAAI,MAAM,KAAK,IAAI;YACpE,KAAK,KAAK;YACV;YACA,KAAK,IAAI,IAAI;YACb,KAAK,KAAK,IAAI;SACf;QAGH,MAAM,SAAS,WAAW,QAAQ;QAClC,QAAQ,GAAG,CAAC,8BAA8B;QAE1C,MAAM,eAAe,MAAM,IAAA,oHAAK,EAC9B,CAAC;sCAC+B,CAAC,EACjC;YACE;YACA,KAAK,UAAU;YACf,KAAK,aAAa;YAClB,KAAK,WAAW;YAChB,KAAK,WAAW,IAAI,KAAK,KAAK;YAC9B,KAAK,UAAU,IAAI;YACnB,KAAK,WAAW,IAAI;YACpB,KAAK,gBAAgB,IAAI;SAC1B;QAGH,QAAQ,GAAG,CAAC,gCAAgC,aAAa,QAAQ;QAEjE,MAAM,WAAW,MAAM,IAAA,oHAAK,EAAC,2EAA2E;YAAC;SAAO;QAChH,MAAM,aAAa,MAAM,IAAA,oHAAK,EAAC,sCAAsC;YAAC,aAAa,QAAQ;SAAC;QAE5F,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;gBACJ,GAAG,QAAQ,CAAC,EAAE;gBACd,QAAQ,UAAU,CAAC,EAAE;YACvB;YACA,SAAS;QACX;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;QAA6B,GAAG;YAAE,QAAQ;QAAI;IAClG;AACF","debugId":null}}]
}