(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32189,(e,t,r)=>{"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},65156,(e,t,r)=>{"use strict";var n=e.r(32189);function a(){}function o(){}o.resetWarningCache=a,t.exports=function(){function e(e,t,r,a,o,s){if(s!==n){var i=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw i.name="Invariant Violation",i}}function t(){return e}e.isRequired=e;var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:a};return r.PropTypes=r,r}},45009,(e,t,r)=>{t.exports=e.r(65156)()},70992,e=>{"use strict";var t,r=e.i(43476),n=e.i(71645),a=e.i(67881),o=e.i(70065),s=e.i(94179),i=e.i(43531);function l({plan:e,billingCycle:t,onSelectPlan:l}){let[c,d]=(0,n.useState)(!1),u="monthly"===t?e.price_monthly:e.price_yearly,m=new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN",minimumFractionDigits:0}).format(u),p=e.discount_yearly,f=async()=>{d(!0);try{await l(e,t)}finally{d(!1)}};return(0,r.jsxs)(o.Card,{className:"relative flex flex-col border-2 transition-all hover:border-primary hover:shadow-xl",children:[e.name.includes("Profesional")&&(0,r.jsx)("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:(0,r.jsx)(s.Badge,{className:"bg-secondary text-secondary-foreground",children:"Más Popular"})}),(0,r.jsxs)(o.CardHeader,{className:"text-center pb-8",children:[(0,r.jsx)(o.CardTitle,{className:"text-2xl",children:e.name}),(0,r.jsx)(o.CardDescription,{className:"text-base mt-2",children:e.description})]}),(0,r.jsxs)(o.CardContent,{className:"flex-1 space-y-6",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"flex items-baseline justify-center gap-2",children:[(0,r.jsx)("span",{className:"text-4xl font-bold text-foreground",children:m}),(0,r.jsxs)("span",{className:"text-muted-foreground",children:["/","monthly"===t?"mes":"año"]})]}),"yearly"===t&&p>0&&(0,r.jsxs)("p",{className:"mt-2 text-sm text-secondary font-medium",children:["Ahorra ",p,"% pagando anualmente"]})]}),(0,r.jsx)("ul",{className:"space-y-3",children:e.features?.map((e,t)=>(0,r.jsxs)("li",{className:"flex items-start gap-3",children:[(0,r.jsx)(i.Check,{className:"h-5 w-5 shrink-0 text-secondary mt-0.5"}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground leading-relaxed",children:e})]},t))})]}),(0,r.jsx)(o.CardFooter,{children:(0,r.jsx)(a.Button,{onClick:f,disabled:c,className:"w-full",size:"lg",children:c?"Procesando...":"Seleccionar Plan"})})]})}var c=e.i(23750),d=e.i(10708),u=e.i(84762),m=e.i(75254);let p=(0,m.default)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),f=(0,m.default)("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);function h({plan:e,billingCycle:t,onSubmit:s,onBack:i,initialData:l}){let[m,h]=(0,n.useState)(l||{firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",clinicName:"",clinicAddress:"",clinicPhone:"",clinicEmail:"",clinicCity:"",clinicState:"",clinicPostalCode:""}),[x,g]=(0,n.useState)(!1),[y,v]=(0,n.useState)(!1),[j,b]=(0,n.useState)({}),[C,N]=(0,n.useState)(!1);(0,n.useEffect)(()=>{l&&(console.log("[v0] Loading initial data into registration form:",l),h(l))},[l]);let S=e=>{let{name:t,value:r}=e.target;if("phone"===t||"clinicPhone"===t){let e=r.replace(/\D/g,"").slice(0,10),n={...m,[t]:e};h(n);try{localStorage.setItem("vetsystem_registration_form_data",JSON.stringify(n)),console.log("[v0] Form data auto-saved")}catch(e){console.error("[v0] Error saving form data:",e)}j[t]&&b(e=>({...e,[t]:""}));return}let n={...m,[t]:r};h(n);try{localStorage.setItem("vetsystem_registration_form_data",JSON.stringify(n))}catch(e){console.error("[v0] Error saving form data:",e)}j[t]&&b(e=>({...e,[t]:""}))},E=async()=>{try{console.log("[v0] Validating email and phone uniqueness...");let e=await fetch("/api/auth/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:m.email,phone:m.phone})}),t=await e.json();if(console.log("[v0] Validation response:",t),!e.ok){let e={};return"email"===t.field?e.email=t.error:"phone"===t.field?e.phone=t.error:e.general=t.error,b(t=>({...t,...e})),!1}return!0}catch(e){return console.error("[v0] Validation error:",e),b(e=>({...e,general:"Error al validar los datos"})),!1}},w=async e=>{let t;if(e.preventDefault(),t={},m.firstName.trim()||(t.firstName="El nombre es obligatorio"),m.lastName.trim()||(t.lastName="Los apellidos son obligatorios"),m.email.trim()?/\S+@\S+\.\S+/.test(m.email)||(t.email="Correo inválido"):t.email="El correo es obligatorio",m.phone.trim()?10!==m.phone.length&&(t.phone="El teléfono debe tener 10 dígitos"):t.phone="El teléfono es obligatorio",m.password?m.password.length<6&&(t.password="La contraseña debe tener al menos 6 caracteres"):t.password="La contraseña es obligatoria",m.password!==m.confirmPassword&&(t.confirmPassword="Las contraseñas no coinciden"),m.clinicName.trim()||(t.clinicName="El nombre del consultorio es obligatorio"),m.clinicAddress.trim()||(t.clinicAddress="La dirección es obligatoria"),m.clinicPhone.trim()?10!==m.clinicPhone.length&&(t.clinicPhone="El teléfono debe tener 10 dígitos"):t.clinicPhone="El teléfono del consultorio es obligatorio",b(t),0===Object.keys(t).length){N(!0);try{if(!await E())return void N(!1);console.log("[v0] Validation passed, proceeding to payment..."),await s(m)}catch(e){console.error("[v0] Form submission error:",e),b(e=>({...e,general:"Error al procesar el formulario"}))}finally{N(!1)}}},P="monthly"===t?e.price_monthly:e.price_yearly,k=new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN",minimumFractionDigits:0}).format(P);return(0,r.jsxs)(o.Card,{className:"max-w-4xl mx-auto",children:[(0,r.jsxs)(o.CardHeader,{children:[(0,r.jsx)(o.CardTitle,{children:"Crear Cuenta"}),(0,r.jsxs)(o.CardDescription,{children:["Plan seleccionado: ",(0,r.jsx)("strong",{children:e.name})," - ",k,"/","monthly"===t?"mes":"año"]})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("form",{onSubmit:w,className:"space-y-8",children:[j.general&&(0,r.jsx)("div",{className:"bg-destructive/10 text-destructive text-sm p-3 rounded-md border border-destructive/20",children:j.general}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4 text-foreground",children:"Datos Personales"}),(0,r.jsxs)("div",{className:"grid gap-6 sm:grid-cols-2",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.Label,{htmlFor:"firstName",children:"Nombre *"}),(0,r.jsx)(c.Input,{id:"firstName",name:"firstName",value:m.firstName,onChange:S,placeholder:"Juan"}),j.firstName&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:j.firstName})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.Label,{htmlFor:"lastName",children:"Apellidos *"}),(0,r.jsx)(c.Input,{id:"lastName",name:"lastName",value:m.lastName,onChange:S,placeholder:"Pérez García"}),j.lastName&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:j.lastName})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.Label,{htmlFor:"email",children:"Correo Electrónico *"}),(0,r.jsx)(c.Input,{id:"email",name:"email",type:"email",value:m.email,onChange:S,placeholder:"juan@ejemplo.com",className:j.email?"border-destructive":""}),j.email&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:j.email})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.Label,{htmlFor:"phone",children:"Teléfono * (10 dígitos)"}),(0,r.jsx)(c.Input,{id:"phone",name:"phone",type:"tel",value:m.phone,onChange:S,placeholder:"5512345678",maxLength:"10",className:j.phone?"border-destructive":""}),j.phone&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:j.phone})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.Label,{htmlFor:"password",children:"Contraseña *"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(c.Input,{id:"password",name:"password",type:x?"text":"password",value:m.password,onChange:S,placeholder:"Mínimo 6 caracteres"}),(0,r.jsx)("button",{type:"button",onClick:()=>g(!x),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:x?(0,r.jsx)(f,{className:"h-4 w-4"}):(0,r.jsx)(p,{className:"h-4 w-4"})})]}),j.password&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:j.password})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.Label,{htmlFor:"confirmPassword",children:"Confirmar Contraseña *"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(c.Input,{id:"confirmPassword",name:"confirmPassword",type:y?"text":"password",value:m.confirmPassword,onChange:S,placeholder:"Confirma tu contraseña"}),(0,r.jsx)("button",{type:"button",onClick:()=>v(!y),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:y?(0,r.jsx)(f,{className:"h-4 w-4"}):(0,r.jsx)(p,{className:"h-4 w-4"})})]}),j.confirmPassword&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:j.confirmPassword})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4 text-foreground",children:"Datos del Consultorio"}),(0,r.jsxs)("div",{className:"grid gap-6 sm:grid-cols-2",children:[(0,r.jsxs)("div",{className:"space-y-2 sm:col-span-2",children:[(0,r.jsx)(d.Label,{htmlFor:"clinicName",children:"Nombre del Consultorio *"}),(0,r.jsx)(c.Input,{id:"clinicName",name:"clinicName",value:m.clinicName,onChange:S,placeholder:"Clínica Veterinaria San Francisco"}),j.clinicName&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:j.clinicName})]}),(0,r.jsxs)("div",{className:"space-y-2 sm:col-span-2",children:[(0,r.jsx)(d.Label,{htmlFor:"clinicAddress",children:"Dirección *"}),(0,r.jsx)(u.Textarea,{id:"clinicAddress",name:"clinicAddress",value:m.clinicAddress,onChange:S,placeholder:"Calle Principal #123, Colonia Centro",rows:2}),j.clinicAddress&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:j.clinicAddress})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.Label,{htmlFor:"clinicPhone",children:"Teléfono del Consultorio * (10 dígitos)"}),(0,r.jsx)(c.Input,{id:"clinicPhone",name:"clinicPhone",type:"tel",value:m.clinicPhone,onChange:S,placeholder:"5512345678",maxLength:"10",className:j.clinicPhone?"border-destructive":""}),j.clinicPhone&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:j.clinicPhone})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.Label,{htmlFor:"clinicEmail",children:"Email del Consultorio"}),(0,r.jsx)(c.Input,{id:"clinicEmail",name:"clinicEmail",type:"email",value:m.clinicEmail,onChange:S,placeholder:"contacto@clinica.com"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.Label,{htmlFor:"clinicCity",children:"Ciudad"}),(0,r.jsx)(c.Input,{id:"clinicCity",name:"clinicCity",value:m.clinicCity,onChange:S,placeholder:"Ciudad de México"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.Label,{htmlFor:"clinicState",children:"Estado"}),(0,r.jsx)(c.Input,{id:"clinicState",name:"clinicState",value:m.clinicState,onChange:S,placeholder:"CDMX"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.Label,{htmlFor:"clinicPostalCode",children:"Código Postal"}),(0,r.jsx)(c.Input,{id:"clinicPostalCode",name:"clinicPostalCode",value:m.clinicPostalCode,onChange:S,placeholder:"01000"})]})]})]}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)(a.Button,{type:"button",variant:"outline",onClick:i,className:"flex-1 bg-transparent",children:"Volver"}),(0,r.jsx)(a.Button,{type:"submit",disabled:C,className:"flex-1",children:C?"Validando...":"Continuar al Pago"})]})]})})]})}var x=e.i(45009);function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach(function(t){j(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,a=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=a){var o=[],s=!0,i=!1;try{for(a=a.call(e);!(s=(r=a.next()).done)&&(o.push(r.value),!t||o.length!==t);s=!0);}catch(e){i=!0,n=e}finally{try{s||null==a.return||a.return()}finally{if(i)throw n}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return C(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return C(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var N=function(e,t,r){var a=!!r,o=n.default.useRef(r);n.default.useEffect(function(){o.current=r},[r]),n.default.useEffect(function(){if(!a||!e)return function(){};var r=function(){o.current&&o.current.apply(o,arguments)};return e.on(t,r),function(){e.off(t,r)}},[a,t,e,o])},S=function(e){var t=n.default.useRef(e);return n.default.useEffect(function(){t.current=e},[e]),t.current},E=function(e){return null!==e&&"object"===v(e)},w="[object Object]",P=function e(t,r){if(!E(t)||!E(r))return t===r;var n=Array.isArray(t);if(n!==Array.isArray(r))return!1;var a=Object.prototype.toString.call(t)===w;if(a!==(Object.prototype.toString.call(r)===w))return!1;if(!a&&!n)return t===r;var o=Object.keys(t),s=Object.keys(r);if(o.length!==s.length)return!1;for(var i={},l=0;l<o.length;l+=1)i[o[l]]=!0;for(var c=0;c<s.length;c+=1)i[s[c]]=!0;var d=Object.keys(i);return d.length===o.length&&d.every(function(n){return e(t[n],r[n])})},k="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",O=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k;if(null===e||E(e)&&"function"==typeof e.elements&&"function"==typeof e.createToken&&"function"==typeof e.createPaymentMethod&&"function"==typeof e.confirmCardPayment)return e;throw Error(t)},_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k;if(E(e)&&"function"==typeof e.then)return{tag:"async",stripePromise:Promise.resolve(e).then(function(e){return O(e,t)})};var r=O(e,t);return null===r?{tag:"empty"}:{tag:"sync",stripe:r}},I=function(e){e&&e._registerWrapper&&e.registerAppInfo&&(e._registerWrapper({name:"react-stripe-js",version:"5.3.0"}),e.registerAppInfo({name:"react-stripe-js",version:"5.3.0",url:"https://stripe.com/docs/stripe-js/react"}))},L=n.default.createContext(null);L.displayName="ElementsContext";var T=function(e,t){if(!e)throw Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e};x.default.any,x.default.object,x.default.func.isRequired;var A=n.default.createContext(null);A.displayName="CheckoutContext",x.default.any,x.default.shape({clientSecret:x.default.oneOfType([x.default.string,x.default.instanceOf(Promise)]).isRequired,elementsOptions:x.default.object}).isRequired;var R=function(e){var t=n.default.useContext(A),r=n.default.useContext(L);if(!t)return T(r,e);if(!r)return t;throw Error("You cannot wrap the part of your app that ".concat(e," in both <CheckoutProvider> and <Elements> providers."))},F=["mode"],B=function(e,t){var r="".concat(e.charAt(0).toUpperCase()+e.slice(1),"Element"),a=t?function(e){R("mounts <".concat(r,">"));var t=e.id,a=e.className;return n.default.createElement("div",{id:t,className:a})}:function(t){var a,o=t.id,s=t.className,i=t.options,l=void 0===i?{}:i,c=t.onBlur,d=t.onFocus,u=t.onReady,m=t.onChange,p=t.onEscape,f=t.onClick,h=t.onLoadError,x=t.onLoaderStart,g=t.onNetworksChange,v=t.onConfirm,C=t.onCancel,w=t.onShippingAddressChange,k=t.onShippingRateChange,O=t.onSavedPaymentMethodRemove,_=t.onSavedPaymentMethodUpdate,I=R("mounts <".concat(r,">")),L="elements"in I?I.elements:null,T="checkoutState"in I?I.checkoutState:null,A=(null==T?void 0:T.type)==="success"||(null==T?void 0:T.type)==="loading"?T.sdk:null,B=b(n.default.useState(null),2),D=B[0],M=B[1],q=n.default.useRef(null),U=n.default.useRef(null);N(D,"blur",c),N(D,"focus",d),N(D,"escape",p),N(D,"click",f),N(D,"loaderror",h),N(D,"loaderstart",x),N(D,"networkschange",g),N(D,"confirm",v),N(D,"cancel",C),N(D,"shippingaddresschange",w),N(D,"shippingratechange",k),N(D,"savedpaymentmethodremove",O),N(D,"savedpaymentmethodupdate",_),N(D,"change",m),u&&(a="expressCheckout"===e?u:function(){u(D)}),N(D,"ready",a),n.default.useLayoutEffect(function(){if(null===q.current&&null!==U.current&&(L||A)){var t=null;if(A)switch(e){case"payment":t=A.createPaymentElement(l);break;case"address":if("mode"in l){var n=l.mode,a=function(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}(l,F);if("shipping"===n)t=A.createShippingAddressElement(a);else if("billing"===n)t=A.createBillingAddressElement(a);else throw Error("Invalid options.mode. mode must be 'billing' or 'shipping'.")}else throw Error("You must supply options.mode. mode must be 'billing' or 'shipping'.");break;case"expressCheckout":t=A.createExpressCheckoutElement(l);break;case"currencySelector":t=A.createCurrencySelectorElement();break;case"taxId":t=A.createTaxIdElement(l);break;default:throw Error("Invalid Element type ".concat(r,". You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />."))}else L&&(t=L.create(e,l));q.current=t,M(t),t&&t.mount(U.current)}},[L,A,l]);var Y=S(l);return n.default.useEffect(function(){if(q.current){var e,t,r,n=(e=l,t=Y,r=["paymentRequest"],E(e)?Object.keys(e).reduce(function(n,a){var o=!E(t)||!P(e[a],t[a]);return r.includes(a)?(o&&console.warn("Unsupported prop change: options.".concat(a," is not a mutable property.")),n):o?y(y({},n||{}),{},j({},a,e[a])):n},null):null);n&&"update"in q.current&&q.current.update(n)}},[l,Y]),n.default.useLayoutEffect(function(){return function(){if(q.current&&"function"==typeof q.current.destroy)try{q.current.destroy(),q.current=null}catch(e){}}},[]),n.default.createElement("div",{id:o,className:s,ref:U})};return a.propTypes={id:x.default.string,className:x.default.string,onChange:x.default.func,onBlur:x.default.func,onFocus:x.default.func,onReady:x.default.func,onEscape:x.default.func,onClick:x.default.func,onLoadError:x.default.func,onLoaderStart:x.default.func,onNetworksChange:x.default.func,onConfirm:x.default.func,onCancel:x.default.func,onShippingAddressChange:x.default.func,onShippingRateChange:x.default.func,onSavedPaymentMethodRemove:x.default.func,onSavedPaymentMethodUpdate:x.default.func,options:x.default.object},a.displayName=r,a.__elementType=e,a},D="undefined"==typeof window,M=n.default.createContext(null);M.displayName="EmbeddedCheckoutProviderContext";var q=function(){var e=n.default.useContext(M);if(!e)throw Error("<EmbeddedCheckout> must be used within <EmbeddedCheckoutProvider>");return e},U=function(e){var t=e.stripe,r=e.options,a=e.children,o=n.default.useMemo(function(){return _(t,"Invalid prop `stripe` supplied to `EmbeddedCheckoutProvider`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.")},[t]),s=n.default.useRef(null),i=n.default.useRef(null),l=b(n.default.useState({embeddedCheckout:null}),2),c=l[0],d=l[1];n.default.useEffect(function(){if(!i.current&&!s.current){var e=function(e){i.current||s.current||(i.current=e,s.current=i.current.initEmbeddedCheckout(r).then(function(e){d({embeddedCheckout:e})}))};"async"===o.tag&&!i.current&&(r.clientSecret||r.fetchClientSecret)?o.stripePromise.then(function(t){t&&e(t)}):"sync"===o.tag&&!i.current&&(r.clientSecret||r.fetchClientSecret)&&e(o.stripe)}},[o,r,c,i]),n.default.useEffect(function(){return function(){c.embeddedCheckout?(s.current=null,c.embeddedCheckout.destroy()):s.current&&s.current.then(function(){s.current=null,c.embeddedCheckout&&c.embeddedCheckout.destroy()})}},[c.embeddedCheckout]),n.default.useEffect(function(){I(i)},[i]);var u=S(t);n.default.useEffect(function(){null!==u&&u!==t&&console.warn("Unsupported prop change on EmbeddedCheckoutProvider: You cannot change the `stripe` prop after setting it.")},[u,t]);var m=S(r);return n.default.useEffect(function(){if(null!=m){if(null==r)return void console.warn("Unsupported prop change on EmbeddedCheckoutProvider: You cannot unset options after setting them.");void 0===r.clientSecret&&void 0===r.fetchClientSecret&&console.warn("Invalid props passed to EmbeddedCheckoutProvider: You must provide one of either `options.fetchClientSecret` or `options.clientSecret`."),null!=m.clientSecret&&r.clientSecret!==m.clientSecret&&console.warn("Unsupported prop change on EmbeddedCheckoutProvider: You cannot change the client secret after setting it. Unmount and create a new instance of EmbeddedCheckoutProvider instead."),null!=m.fetchClientSecret&&r.fetchClientSecret!==m.fetchClientSecret&&console.warn("Unsupported prop change on EmbeddedCheckoutProvider: You cannot change fetchClientSecret after setting it. Unmount and create a new instance of EmbeddedCheckoutProvider instead."),null!=m.onComplete&&r.onComplete!==m.onComplete&&console.warn("Unsupported prop change on EmbeddedCheckoutProvider: You cannot change the onComplete option after setting it."),null!=m.onShippingDetailsChange&&r.onShippingDetailsChange!==m.onShippingDetailsChange&&console.warn("Unsupported prop change on EmbeddedCheckoutProvider: You cannot change the onShippingDetailsChange option after setting it."),null!=m.onLineItemsChange&&r.onLineItemsChange!==m.onLineItemsChange&&console.warn("Unsupported prop change on EmbeddedCheckoutProvider: You cannot change the onLineItemsChange option after setting it.")}},[m,r]),n.default.createElement(M.Provider,{value:c},a)},Y=D?function(e){var t=e.id,r=e.className;return q(),n.default.createElement("div",{id:t,className:r})}:function(e){var t=e.id,r=e.className,a=q().embeddedCheckout,o=n.default.useRef(!1),s=n.default.useRef(null);return n.default.useLayoutEffect(function(){return!o.current&&a&&null!==s.current&&(a.mount(s.current),o.current=!0),function(){if(o.current&&a)try{a.unmount(),o.current=!1}catch(e){}}},[a]),n.default.createElement("div",{ref:s,id:t,className:r})};B("auBankAccount",D),B("card",D),B("cardNumber",D),B("cardExpiry",D),B("cardCvc",D),B("iban",D),B("payment",D),B("expressCheckout",D),B("paymentRequestButton",D),B("linkAuthentication",D),B("address",D),B("shippingAddress",D),B("paymentMethodMessaging",D),B("taxId",D);var z="clover",V="https://js.stripe.com",H="".concat(V,"/").concat(z,"/stripe.js"),J=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,W=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,X=function(){for(var e=document.querySelectorAll('script[src^="'.concat(V,'"]')),t=0;t<e.length;t++){var r,n=e[t];if(r=n.src,J.test(r)||W.test(r))return n}return null},K=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",r=document.createElement("script");r.src="".concat(H).concat(t);var n=document.head||document.body;if(!n)throw Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return n.appendChild(r),r},$=function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"8.4.0",startTime:t})},G=null,Q=null,Z=null,ee=function(e,t,r){if(null===e)return null;var n,a=t[0].match(/^pk_test/),o=3===(n=e.version)?"v3":n;a&&o!==z&&console.warn("Stripe.js@".concat(o," was loaded on the page, but @stripe/stripe-js@").concat("8.4.0"," expected Stripe.js@").concat(z,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var s=e.apply(void 0,t);return $(s,r),s},et=!1,er=function(){return t?t:t=(null!==G?G:(G=new Promise(function(e,t){if("undefined"==typeof window||"undefined"==typeof document)return void e(null);if(window.Stripe,window.Stripe)return void e(window.Stripe);try{var r,n=X();n?n&&null!==Z&&null!==Q&&(n.removeEventListener("load",Z),n.removeEventListener("error",Q),null==(r=n.parentNode)||r.removeChild(n),n=K(null)):n=K(null),Z=function(){window.Stripe?e(window.Stripe):t(Error("Stripe.js not available"))},Q=function(e){t(Error("Failed to load Stripe.js",{cause:e}))},n.addEventListener("load",Z),n.addEventListener("error",Q)}catch(e){t(e);return}})).catch(function(e){return G=null,Promise.reject(e)})).catch(function(e){return t=null,Promise.reject(e)})};Promise.resolve().then(function(){return er()}).catch(function(e){et||console.warn(e)});var en=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];et=!0;var n=Date.now();return er().then(function(e){return ee(e,t,n)})};e.i(47167);let ea=null;function eo({plan:e,billingCycle:t,userData:s,onBack:i,onSuccess:l}){let[c,d]=(0,n.useState)(null),[u,m]=(0,n.useState)(null),[p,f]=(0,n.useState)(null),[h,x]=(0,n.useState)(null),[g,y]=(0,n.useState)(!1),[v,j]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=function(){let e;if(ea)return ea;let t=(console.log("[v0] Stripe publishable key found:",(e="pk_test_51ST2k31LGdPqIkO0qS3fzHRz8oHuAM38jebS06xhMX0NtTqrfwj1qbR3BKFZmVpwQHBtBNhcCjeRa8mjohqyGY3M00u4gZ5Ij9").substring(0,20)+"..."),e);if(!t)return console.error("[v0] Cannot initialize Stripe: No publishable key found"),null;try{ea=en(t),console.log("[v0] Stripe initialized successfully")}catch(e){return console.error("[v0] Error loading Stripe:",e),null}return ea}();e?x(e):f("La configuración de Stripe no está disponible. Por favor verifica que la integración esté correctamente configurada.")},[]);let b=(0,n.useCallback)(async()=>{try{console.log("[v0] Creating checkout session..."),console.log("[v0] Plan:",e),console.log("[v0] Billing cycle:",t);let r=e.stripe_id;console.log("[v0] Product ID:",r);let n=await fetch("/api/stripe/create-checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:r,userData:s})}),a=await n.json();if(console.log("[v0] Checkout API response:",a),!n.ok)throw Error(a.error||"Error al crear sesión de pago");console.log("[v0] Checkout session created successfully");let o=a.clientSecret.split("_secret_")[0];return m(o),a.clientSecret}catch(e){return console.error("[v0] Error fetching client secret:",e),f(e.message),null}},[e,t,s]);(0,n.useEffect)(()=>{h&&b().then(e=>{e&&d(e)})},[b,h]),(0,n.useEffect)(()=>{if(!u||g)return;let e=setInterval(async()=>{try{console.log("[v0] Checking payment status for session:",u);let e=await fetch("/api/stripe/check-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:u})}),t=await e.json();if(console.log("[v0] Payment status response:",t),"expired"===t.status||"canceled"===t.status){j("La sesión de pago ha expirado o fue cancelada. Por favor intenta nuevamente."),y(!0);return}if("unpaid"===t.payment_status&&t.last_error){let e=C(t.last_error);j(e),y(!0);return}if("paid"===t.payment_status&&"complete"===t.status){console.log("[v0] Payment succeeded! Registering user..."),y(!0);let e=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),t=await e.json();console.log("[v0] Registration response:",t),t.success?(console.log("[v0] User registered successfully:",t.data),localStorage.removeItem("vetsystem_registration_form_data"),l&&l(s.firstName)):(console.error("[v0] Registration failed:",t.error),j(`Error al completar el registro: ${t.error}. Por favor contacta soporte.`))}}catch(e){console.error("[v0] Error checking payment status:",e),j("Error al verificar el estado del pago. Por favor contacta soporte.")}},2e3);return()=>clearInterval(e)},[u,s,g,l]);let C=e=>e?({card_declined:"Tu tarjeta fue rechazada. Por favor intenta con otra tarjeta.",insufficient_funds:"Fondos insuficientes. Por favor verifica el saldo de tu tarjeta.",expired_card:"Tu tarjeta ha expirado. Por favor usa una tarjeta válida.",incorrect_cvc:"El código de seguridad (CVC) es incorrecto.",processing_error:"Error al procesar el pago. Por favor intenta nuevamente.",incorrect_number:"El número de tarjeta es incorrecto.",invalid_expiry_month:"El mes de vencimiento es inválido.",invalid_expiry_year:"El año de vencimiento es inválido.",authentication_required:"Tu banco requiere autenticación adicional. Por favor completa la verificación."})[e.code||e.decline_code]||e.message||"Error al procesar el pago. Por favor intenta nuevamente.":"Error desconocido en el pago.";return(0,n.useEffect)(()=>{v&&alert(v)},[v]),(0,r.jsxs)("div",{className:"max-w-2xl mx-auto space-y-4",children:[(0,r.jsx)(a.Button,{onClick:i,variant:"outline",children:"Volver"}),p?(0,r.jsxs)(o.Card,{children:[(0,r.jsxs)(o.CardHeader,{children:[(0,r.jsx)(o.CardTitle,{children:"Error de Configuración"}),(0,r.jsx)(o.CardDescription,{children:"Hubo un problema al inicializar el sistema de pagos"})]}),(0,r.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,r.jsx)("p",{className:"text-destructive",children:p}),(0,r.jsxs)("div",{className:"bg-muted p-4 rounded-lg text-sm",children:[(0,r.jsx)("p",{className:"font-semibold mb-2",children:"Información técnica:"}),(0,r.jsxs)("p",{children:["Si eres el administrador del sistema, verifica que la variable de entorno"," ",(0,r.jsx)("code",{className:"bg-background px-2 py-1 rounded",children:"NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY"})," esté configurada correctamente en tu proyecto de Vercel."]})]})]})]}):c&&h?(0,r.jsx)("div",{id:"checkout",children:(0,r.jsx)(U,{stripe:h,options:{clientSecret:c},children:(0,r.jsx)(Y,{})})}):(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardContent,{className:"py-12",children:(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-4",children:[(0,r.jsx)("div",{className:"h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Preparando formulario de pago..."})]})})})]})}var es=e.i(44626),ei=e.i(36591),el=e.i(69638),ec=e.i(22016);function ed({userName:e}){return(0,r.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,r.jsxs)(o.Card,{className:"border-secondary",children:[(0,r.jsxs)(o.CardHeader,{className:"text-center space-y-4 pb-6",children:[(0,r.jsx)("div",{className:"mx-auto w-16 h-16 bg-secondary/10 rounded-full flex items-center justify-center",children:(0,r.jsx)(el.CheckCircle,{className:"w-10 h-10 text-secondary"})}),(0,r.jsx)(o.CardTitle,{className:"text-3xl",children:"¡Compra Exitosa!"})]}),(0,r.jsxs)(o.CardContent,{className:"space-y-6 text-center",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("p",{className:"text-xl font-semibold",children:["¡Bienvenido al equipo, ",e,"!"]}),(0,r.jsx)("p",{className:"text-muted-foreground text-pretty leading-relaxed",children:"Tu cuenta ha sido creada exitosamente y tu pago ha sido procesado. Ya puedes comenzar a administrar tu clínica veterinaria con todas las herramientas que te ofrecemos."})]}),(0,r.jsxs)("div",{className:"bg-muted/50 rounded-lg p-6 space-y-3 text-sm",children:[(0,r.jsx)("p",{className:"font-semibold",children:"¿Qué sigue?"}),(0,r.jsxs)("ul",{className:"text-left space-y-2 max-w-md mx-auto",children:[(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-secondary mt-0.5",children:"•"}),(0,r.jsx)("span",{children:"Inicia sesión con tu correo y contraseña"})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-secondary mt-0.5",children:"•"}),(0,r.jsx)("span",{children:"Configura los detalles de tu consultorio"})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-secondary mt-0.5",children:"•"}),(0,r.jsx)("span",{children:"Comienza a gestionar pacientes y consultas"})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-secondary mt-0.5",children:"•"}),(0,r.jsx)("span",{children:"Explora todas las funcionalidades del sistema"})]})]})]}),(0,r.jsx)("div",{className:"pt-4",children:(0,r.jsx)(ec.default,{href:"/login",children:(0,r.jsx)(a.Button,{size:"lg",className:"w-full sm:w-auto px-8",children:"Iniciar Sesión"})})}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground"})]})]})})}let eu="vetsystem_registration_form_data";function em(){let[e,t]=(0,n.useState)([]),[o,s]=(0,n.useState)(!0),[c,d]=(0,n.useState)("monthly"),[u,m]=(0,n.useState)("plans"),[p,f]=(0,n.useState)(null),[x,g]=(0,n.useState)(null),[y,v]=(0,n.useState)(null),[j,b]=(0,n.useState)(!1),[C,N]=(0,n.useState)("");(0,n.useEffect)(()=>{let e=localStorage.getItem(eu);if(e)try{let t=JSON.parse(e);v(t),console.log("[v0] Loaded saved form data from localStorage:",t)}catch(e){console.error("[v0] Error parsing saved form data:",e)}},[]),(0,n.useEffect)(()=>{!async function(){try{let e=await fetch("/api/plans"),r=await e.json();t(r.plans||[])}catch(e){console.error("[v0] Error loading plans:",e)}finally{s(!1)}}()},[]);let S=async(e,t)=>{f(e),d(t),m("register")},E=async e=>{console.log("[v0] Saving registration data for payment:",e),g(e),m("checkout")};return o?(0,r.jsx)("div",{className:"container mx-auto px-4 py-20",children:(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)("div",{className:"h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent"})})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(es.LandingNavbar,{}),(0,r.jsx)("div",{className:"container mx-auto px-4 py-12 md:py-20",children:j?(0,r.jsx)(ed,{userName:C}):(0,r.jsxs)(r.Fragment,{children:["plans"===u&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mx-auto max-w-3xl text-center mb-12",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold text-balance text-foreground mb-4",children:"Planes y Precios"}),(0,r.jsx)("p",{className:"text-lg text-muted-foreground text-pretty leading-relaxed",children:"Elige el plan que mejor se adapte a las necesidades de tu clínica veterinaria. Todos los planes incluyen 14 días de prueba gratuita."})]}),(0,r.jsxs)("div",{className:"flex items-center justify-center gap-4 mb-12",children:[(0,r.jsx)(a.Button,{variant:"monthly"===c?"default":"outline",onClick:()=>d("monthly"),children:"Mensual"}),(0,r.jsxs)(a.Button,{variant:"yearly"===c?"default":"outline",onClick:()=>d("yearly"),className:"relative",children:["Anual",(0,r.jsx)("span",{className:"absolute -top-3 -right-3 rounded-full bg-secondary px-2 py-0.5 text-xs text-secondary-foreground",children:"Ahorra 17%"})]})]}),(0,r.jsx)("div",{className:"grid gap-8 md:grid-cols-3 max-w-6xl mx-auto mb-16",children:e.map(e=>(0,r.jsx)(l,{plan:e,billingCycle:c,onSelectPlan:S},e.stripe_id))}),(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-center mb-8",children:"Lo que Incluyen Todos los Planes"}),(0,r.jsx)("div",{className:"grid gap-4 sm:grid-cols-2",children:["Actualizaciones automáticas","Soporte técnico","Respaldo diario de información","Seguridad SSL","Acceso desde cualquier dispositivo","Reportes y estadísticas"].map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center gap-3 text-muted-foreground",children:[(0,r.jsx)(i.Check,{className:"h-5 w-5 text-secondary shrink-0"}),(0,r.jsx)("span",{children:e})]},t))})]})]}),"register"===u&&p&&(0,r.jsx)(h,{plan:p,billingCycle:c,onSubmit:E,onBack:()=>m("plans"),initialData:y}),"checkout"===u&&p&&x&&(0,r.jsx)(eo,{plan:p,billingCycle:c,userData:x,onBack:()=>{let e=localStorage.getItem(eu);if(e)try{let t=JSON.parse(e);v(t),console.log("[v0] Reloaded form data when going back:",t)}catch(e){console.error("[v0] Error reloading form data:",e)}m("register")},onSuccess:e=>{N(e),b(!0)}})]})}),(0,r.jsx)(ei.LandingFooter,{})]})}e.s(["default",()=>em],70992)}]);