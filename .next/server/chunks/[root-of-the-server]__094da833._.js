module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},27699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},80998,e=>{"use strict";let t;var r=e.i(22244);let a={host:process.env.DB_HOST||"174.136.31.150",user:process.env.DB_USER||"mavishop_myvetadmin",password:process.env.DB_PASSWORD||"KDZ-2y_O#cmI^v7r",database:process.env.DB_NAME||"mavishop_myvetadmin",waitForConnections:!0,connectionLimit:10,queueLimit:0,enableKeepAlive:!0,keepAliveInitialDelay:0};async function n(){return t||(t=r.default.createPool(a)),t}async function s(e,t){let r=await n();try{let[a]=await r.execute(e,t);return a}catch(e){throw e}}e.s(["getConnection",()=>n,"query",()=>s])},21388,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),s=e.i(61916),i=e.i(14444),o=e.i(37092),l=e.i(69741),u=e.i(16795),c=e.i(87718),d=e.i(95169),p=e.i(47587),m=e.i(66012),h=e.i(70101),x=e.i(26937),R=e.i(10372),v=e.i(93695);e.i(52474);var y=e.i(220),E=e.i(89171),g=e.i(80998);async function N(e){try{let{searchParams:t}=new URL(e.url),r=t.get("userId"),a=t.get("clinicId");if(!r||!a)return E.NextResponse.json({success:!1,error:"userId y clinicId son requeridos"},{status:400});let n=(await (0,g.query)(`SELECT s.*, 
        (SELECT JSON_ARRAYAGG(
          JSON_OBJECT('id', si.inventory_id, 'name', si.item_name, 'quantity', si.quantity, 'price', si.unit_price, 'subtotal', si.subtotal)
        ) FROM sale_items si WHERE si.sale_id = s.id) as items
       FROM sales s
       WHERE s.user_id = ? AND s.clinic_id = ?
       ORDER BY s.sale_date DESC`,[r,a])).map(e=>({...e,items:e.items?JSON.parse(e.items):[]}));return E.NextResponse.json({success:!0,data:n})}catch(e){return console.error("Get sales error:",e),E.NextResponse.json({success:!1,error:"Error al obtener ventas"},{status:500})}}async function b(e){let t;try{let r=await e.json();if(!r.userId||!r.clinicId)return E.NextResponse.json({success:!1,error:"userId y clinicId son requeridos"},{status:400,headers:{"Content-Type":"application/json"}});if(!r.items||0===r.items.length)return E.NextResponse.json({success:!1,error:"La venta debe tener al menos un artÃ­culo"},{status:400,headers:{"Content-Type":"application/json"}});t=await (0,g.getConnection)(),t=await t.getConnection(),await t.beginTransaction();let a=`VTA-${new Date().getFullYear()}-${Date.now()}`,n=Number.parseFloat(r.subtotal)||0,s=Number.parseFloat(r.tax)||0,i=Number.parseFloat(r.discount)||0,o=Number.parseFloat(r.total)||0,l=Number.parseFloat(r.amountPaid)||o,u=Number.parseFloat(r.change)||0,[c]=await t.execute(`INSERT INTO sales (user_id, clinic_id, sale_number, customer_name, subtotal, tax, discount, total, payment_method, amount_paid, change_amount, notes, cashier, sale_date)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, NOW())`,[Number.parseInt(r.userId),Number.parseInt(r.clinicId),a,r.customer||"Cliente general",n,s,i,o,r.paymentMethod||"Efectivo",l,u,r.notes||null,r.cashier||"Cajero"]),d=c.insertId,p=[];for(let e of r.items){let a=Number.parseFloat(e.price)||0,n=Number.parseInt(e.quantity)||1,s=a*n;await t.execute(`INSERT INTO sale_items (sale_id, inventory_id, item_name, quantity, unit_price, subtotal)
         VALUES (?, ?, ?, ?, ?, ?)`,[d,Number.parseInt(e.id),e.name,n,a,s]),p.push({id:Number.parseInt(e.id),name:e.name,quantity:n,price:a,subtotal:s}),await t.execute("UPDATE inventory SET stock = stock - ? WHERE id = ? AND user_id = ? AND clinic_id = ?",[n,Number.parseInt(e.id),Number.parseInt(r.userId),Number.parseInt(r.clinicId)])}await t.execute(`INSERT INTO accounting (user_id, clinic_id, type, category_id, amount, description, transaction_date, payment_method)
       VALUES (?, ?, ?, ?, ?, ?, CURDATE(), ?)`,[Number.parseInt(r.userId),Number.parseInt(r.clinicId),"Ingreso",1,o,`Venta ${a}`,r.paymentMethod||"Efectivo"]),await t.commit();let m={id:d,saleNumber:a,customerName:r.customer||"Cliente general",subtotal:n,tax:s,discount:i,total:o,paymentMethod:r.paymentMethod||"Efectivo",amountPaid:l,changeAmount:u,cashier:r.cashier||"Cajero",saleDate:new Date().toISOString(),items:p};return E.NextResponse.json({success:!0,data:m,message:"Venta procesada exitosamente"},{status:200,headers:{"Content-Type":"application/json"}})}catch(e){if(t)try{await t.rollback()}catch(e){console.error("Rollback error:",e)}return E.NextResponse.json({success:!1,error:e.message||"Error al procesar venta",details:void 0},{status:500,headers:{"Content-Type":"application/json"}})}finally{if(t)try{t.release()}catch(e){console.error("[v0] Connection release error:",e)}}}e.s(["GET",()=>N,"POST",()=>b],67048);var f=e.i(67048);let w=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/sales/route",pathname:"/api/sales",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/sales/route.js",nextConfigOutput:"",userland:f}),{workAsyncStorage:_,workUnitAsyncStorage:C,serverHooks:I}=w;function A(){return(0,a.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:C})}async function T(e,t,a){w.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let E="/api/sales/route";E=E.replace(/\/index$/,"")||"/";let g=await w.prepare(e,t,{srcPage:E,multiZoneDraftMode:!1});if(!g)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:N,params:b,nextConfig:f,parsedUrl:_,isDraftMode:C,prerenderManifest:I,routerServerContext:A,isOnDemandRevalidate:T,revalidateOnlyGenerated:S,resolvedPathname:O,clientReferenceManifest:q,serverActionsManifest:j}=g,D=(0,l.normalizeAppPath)(E),P=!!(I.dynamicRoutes[D]||I.routes[O]),k=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,_,!1):t.end("This page could not be found"),null);if(P&&!C){let e=!!I.routes[O],t=I.dynamicRoutes[D];if(t&&!1===t.fallback&&!e){if(f.experimental.adapterPath)return await k();throw new v.NoFallbackError}}let M=null;!P||w.isDev||C||(M="/index"===(M=O)?"/":M);let U=!0===w.isDev||!P,H=P&&!U;j&&q&&(0,i.setReferenceManifestsSingleton)({page:E,clientReferenceManifest:q,serverActionsManifest:j,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:j})});let F=e.method||"GET",L=(0,s.getTracer)(),$=L.getActiveScopeSpan(),B={params:b,prerenderManifest:I,renderOpts:{experimental:{authInterrupts:!!f.experimental.authInterrupts},cacheComponents:!!f.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:f.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>w.onRequestError(e,t,a,A)},sharedContext:{buildId:N}},K=new u.NodeNextRequest(e),V=new u.NodeNextResponse(t),G=c.NextRequestAdapter.fromNodeNextRequest(K,(0,c.signalFromNodeResponse)(t));try{let i=async e=>w.handle(G,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=L.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${F} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${E}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var s,l;let u=async({previousCacheEntry:r})=>{try{if(!o&&T&&S&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await i(n);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=B.renderOpts.collectedTags;if(!P)return await (0,m.sendResponse)(K,V,s,B.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(s.headers);u&&(t[R.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,a=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await w.onRequestError(e,t,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:T})},A),t}},c=await w.handleResponse({req:e,nextConfig:f,cacheKey:M,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:I,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:S,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:o});if(!P)return null;if((null==c||null==(s=c.value)?void 0:s.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",T?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,h.fromNodeOutgoingHttpHeaders)(c.value.headers);return o&&P||d.delete(R.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,x.getCacheControlHeader)(c.cacheControl)),await (0,m.sendResponse)(K,V,new Response(c.value.body,{headers:d,status:c.value.status||200})),null};$?await l($):await L.withPropagatedContext(e.headers,()=>L.trace(d.BaseServerSpan.handleRequest,{spanName:`${F} ${E}`,kind:s.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},l))}catch(t){if(t instanceof v.NoFallbackError||await w.onRequestError(e,t,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:T})}),P)throw t;return await (0,m.sendResponse)(K,V,new Response(null,{status:500})),null}}e.s(["handler",()=>T,"patchFetch",()=>A,"routeModule",()=>w,"serverHooks",()=>I,"workAsyncStorage",()=>_,"workUnitAsyncStorage",()=>C],21388)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__094da833._.js.map