module.exports=[1085,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(40695),e=a.i(15618),f=a.i(65733),g=a.i(5522),h=a.i(17171),i=a.i(46893),j=a.i(87682),k=a.i(3130),l=a.i(88237),m=a.i(87532),n=a.i(24569),o=a.i(81560),p=a.i(3183),q=a.i(19966),r=a.i(1484),s=a.i(41675),t=a.i(16201),u=a.i(41710),v=a.i(4720),w=a.i(17493);function x({consultations:a,onFilterClick:c,activeFilter:d}){let e=a.length,f=a.filter(a=>"Completada"===a.status).length,g=a.filter(a=>"Pendiente"===a.status).length,h=a.filter(a=>"En Proceso"===a.status).length,i=[{label:"Total Consultas",value:e,icon:v.FileText,color:"text-primary",filter:null,subtitle:"Registros totales"},{label:"Completadas",value:f,icon:t.CheckCircle,color:"text-green-500",filter:"Completada",subtitle:"Finalizadas exitosamente"},{label:"En Proceso",value:h,icon:u.Clock,color:"text-yellow-500",filter:"En Proceso",subtitle:"En atención actualmente"},{label:"Pendientes",value:g,icon:s.Calendar,color:"text-blue-500",filter:"Pendiente",subtitle:"Por atender"}];return(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:i.map(a=>{let e=a.icon,f=d===a.filter;return(0,b.jsx)(w.StatsCard,{label:a.label,value:a.value,icon:e,color:a.color,isActive:f,onClick:()=>c(a.filter),subtitle:a.subtitle},a.label)})})}var y=a.i(86297);function z(){let{user:a,selectedClinic:s,getUserId:t,getClinicId:u}=(0,p.useAuth)(),{showSuccess:v,showError:w,showWarning:z,AlertContainer:A}=(0,r.useAlertToast)(),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)([]),[F,G]=(0,c.useState)([]),[H,I]=(0,c.useState)([]),[J,K]=(0,c.useState)(!1),[L,M]=(0,c.useState)(!1),[N,O]=(0,c.useState)(null),[P,Q]=(0,c.useState)(""),[R,S]=(0,c.useState)(!0),[T,U]=(0,c.useState)(null),[V,W]=(0,c.useState)({patientId:"",patientName:"",ownerName:"",accompaniedBy:"",date:"",reason:"",diagnosis:"",treatment:"",notes:"",veterinarian:"",cost:""}),[X,Y]=(0,c.useState)({name:"",animalType:"",breed:"",age:"",weight:"",sex:"",ownerName:"",ownerPhone:"",medicalHistory:"",diseases:""});(0,c.useEffect)(()=>{a&&s&&(Z(),$(),_())},[a,s]);let Z=async()=>{try{S(!0);let a=t(),b=u();if(!a||!b)return;let c=await fetch(`/api/consultations?userId=${a}&clinicId=${b}`),d=await c.json();d.success?C(d.data||[]):w(d.error||"Error al cargar consultas")}catch(a){console.error("Error fetching consultations:",a),w("Error al cargar las consultas")}finally{S(!1)}},$=async()=>{try{console.log("[v0] Fetching patients...");let a=t(),b=u();if(!a||!b)return void console.log("[v0] Missing userId or clinicId");console.log("[v0] Request params:",{userId:a,clinicId:b});let c=await fetch(`/api/patients?userId=${a}&clinicId=${b}`),d=await c.json();console.log("[v0] Patients API response:",d),d.success?(console.log("[v0] Patients loaded successfully:",d.data.length),E(d.data||[])):(console.log("[v0] API returned error:",d.error),z("No se pudieron cargar los pacientes"))}catch(a){console.error("[v0] Error fetching patients:",a),z("Error al cargar los pacientes")}},_=async()=>{try{let a=t(),b=u();if(!a||!b)return;let c=await fetch(`/api/staff?userId=${a}&clinicId=${b}`),d=await c.json();if(d.success){let a=d.data.filter(a=>a.position&&a.position.toLowerCase().includes("veterinari"));G(a)}else z("No se pudieron cargar los veterinarios")}catch(a){console.error("Error fetching staff:",a)}};(0,c.useEffect)(()=>{aa()},[B,P,T]);let aa=()=>{let a=[...B];T&&(a=a.filter(a=>a.status===T)),P&&(a=a.filter(a=>a.patientName?.toLowerCase().includes(P.toLowerCase())||a.ownerName?.toLowerCase().includes(P.toLowerCase())||a.reason?.toLowerCase().includes(P.toLowerCase())||a.veterinarian?.toLowerCase().includes(P.toLowerCase()))),I(a)},ab=async a=>{if(a.preventDefault(),!V.patientName||!V.ownerName||!V.accompaniedBy||!V.date||!V.reason)return void z("Por favor completa todos los campos obligatorios");let b=t(),c=u(),d=N?"PUT":"POST",e=N?{...V,id:N.id,userId:b,clinicId:c}:{...V,userId:b,clinicId:c},f=await fetch("/api/consultations",{method:d,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),g=await f.json();g.success?(v(N?"Consulta actualizada exitosamente":"Consulta registrada exitosamente"),Z(),ad()):w(g.error||"Error al guardar consulta")},ac=async a=>{if(confirm("¿Estás seguro de eliminar esta consulta?")){let b=t(),c=u(),d=await fetch(`/api/consultations?id=${a}&userId=${b}&clinicId=${c}`,{method:"DELETE"});(await d.json()).success?(v("Consulta eliminada exitosamente"),Z()):w("Error al eliminar la consulta")}},ad=()=>{K(!1),O(null),W({patientId:"",patientName:"",ownerName:"",accompaniedBy:"",date:"",reason:"",diagnosis:"",treatment:"",notes:"",veterinarian:"",cost:""})},ae=async a=>{if(a.preventDefault(),!X.name||!X.animalType||!X.ownerName)return void z("Por favor completa los campos obligatorios del paciente");let b=t(),c=u(),d=await fetch("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...X,lastVisit:new Date().toISOString().split("T")[0],userId:b,clinicId:c})}),e=await d.json();e.success?(v("Paciente registrado exitosamente"),await $(),W({...V,patientId:e.data.id,patientName:e.data.name,ownerName:e.data.ownerName}),M(!1),Y({name:"",animalType:"",breed:"",age:"",weight:"",sex:"",ownerName:"",ownerPhone:"",medicalHistory:"",diseases:""})):w(e.error||"Error al registrar el paciente")},af=a=>{let{name:b,value:c}=a.target;W({...V,[b]:c})};return R?(0,b.jsx)(q.LoadingPage,{message:"Cargando consultas..."}):a&&s?(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsx)(A,{}),(0,b.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Consultas"}),(0,b.jsxs)(d.Button,{onClick:()=>K(!0),children:[(0,b.jsx)(e.Plus,{className:"w-4 h-4 mr-2"}),"Nueva Consulta"]})]}),(0,b.jsx)(x,{consultations:B,onFilterClick:a=>{U(a)},activeFilter:T}),(0,b.jsxs)(k.Card,{className:"p-6",children:[(0,b.jsx)("div",{className:"flex items-center gap-4 mb-6",children:(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(m.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),(0,b.jsx)(g.Input,{placeholder:"Buscar por paciente, dueño, motivo o veterinario...",value:P,onChange:a=>Q(a.target.value),className:"pl-10"})]})}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(l.Table,{children:[(0,b.jsx)(l.TableHeader,{children:(0,b.jsxs)(l.TableRow,{children:[(0,b.jsx)(l.TableHead,{children:"ID"}),(0,b.jsx)(l.TableHead,{children:"Fecha"}),(0,b.jsx)(l.TableHead,{children:"Paciente"}),(0,b.jsx)(l.TableHead,{children:"Dueño"}),(0,b.jsx)(l.TableHead,{children:"Acompañante"}),(0,b.jsx)(l.TableHead,{children:"Motivo"}),(0,b.jsx)(l.TableHead,{children:"Diagnóstico"}),(0,b.jsx)(l.TableHead,{children:"Veterinario"}),(0,b.jsx)(l.TableHead,{children:"Costo"}),(0,b.jsx)(l.TableHead,{className:"text-right",children:"Acciones"})]})}),(0,b.jsx)(l.TableBody,{children:0===H.length?(0,b.jsx)(l.TableRow,{children:(0,b.jsx)(l.TableCell,{colSpan:10,className:"text-center text-muted-foreground",children:"No se encontraron consultas"})}):H.map(a=>(0,b.jsxs)(l.TableRow,{children:[(0,b.jsx)(l.TableCell,{className:"font-medium",children:a.id}),(0,b.jsx)(l.TableCell,{children:new Date(a.date).toLocaleDateString("es-MX")}),(0,b.jsx)(l.TableCell,{children:a.patientName}),(0,b.jsx)(l.TableCell,{children:a.ownerName}),(0,b.jsx)(l.TableCell,{children:a.accompaniedBy}),(0,b.jsx)(l.TableCell,{children:a.reason}),(0,b.jsx)(l.TableCell,{children:a.diagnosis||"-"}),(0,b.jsx)(l.TableCell,{children:a.veterinarian||"-"}),(0,b.jsx)(l.TableCell,{children:(0,y.formatCurrency)(a.cost||0)}),(0,b.jsx)(l.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(d.Button,{variant:"ghost",size:"sm",onClick:()=>{O(a),W({...V,patientId:a.patientId||"",patientName:a.patientName||"",ownerName:a.ownerName||"",accompaniedBy:a.accompaniedBy||"",date:a.date?new Date(a.date).toISOString().split("T")[0]:"",reason:a.reason||"",diagnosis:a.diagnosis||"",treatment:a.treatment||"",notes:a.notes||"",veterinarian:a.veterinarian||"",cost:a.cost||""}),K(!0)},children:(0,b.jsx)(n.Edit,{className:"w-4 h-4"})}),(0,b.jsx)(d.Button,{variant:"ghost",size:"sm",onClick:()=>ac(a.id),children:(0,b.jsx)(o.Trash2,{className:"w-4 h-4 text-destructive"})})]})})]},a.id))})]})})]}),(0,b.jsx)(f.Dialog,{open:J,onOpenChange:K,children:(0,b.jsxs)(f.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)(f.DialogHeader,{children:(0,b.jsx)(f.DialogTitle,{children:N?"Editar Consulta":"Nueva Consulta"})}),(0,b.jsxs)("form",{onSubmit:ab,className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)(h.Label,{children:"Paciente *"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(j.Select,{value:V.patientId,onValueChange:a=>{console.log("[v0] Patient selected:",a),console.log("[v0] Available patients:",D);let b=D.find(b=>b.id===Number.parseInt(a));console.log("[v0] Found patient:",b),b?(W({...V,patientId:b.id,patientName:b.name,ownerName:b.ownerName}),console.log("[v0] Form data updated with patient info")):console.log("[v0] Patient not found in list")},children:[(0,b.jsx)(j.SelectTrigger,{children:(0,b.jsx)(j.SelectValue,{placeholder:"Seleccionar paciente"})}),(0,b.jsx)(j.SelectContent,{children:D.map(a=>(0,b.jsxs)(j.SelectItem,{value:a.id.toString(),children:[a.name," - ",a.ownerName]},a.id))})]}),(0,b.jsx)(d.Button,{type:"button",variant:"outline",onClick:()=>M(!0),children:"Nuevo Paciente"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"patientName",children:"Nombre del Paciente *"}),(0,b.jsx)(g.Input,{id:"patientName",name:"patientName",value:V.patientName,onChange:af,required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"ownerName",children:"Nombre del Dueño *"}),(0,b.jsx)(g.Input,{id:"ownerName",name:"ownerName",value:V.ownerName,onChange:af,required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"accompaniedBy",children:"Acompañado por *"}),(0,b.jsx)(g.Input,{id:"accompaniedBy",name:"accompaniedBy",value:V.accompaniedBy,onChange:af,required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"date",children:"Fecha *"}),(0,b.jsx)(g.Input,{id:"date",name:"date",type:"date",value:V.date,onChange:af,required:!0})]}),(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)(h.Label,{htmlFor:"reason",children:"Motivo de la Consulta *"}),(0,b.jsx)(i.Textarea,{id:"reason",name:"reason",value:V.reason,onChange:af,required:!0})]}),(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)(h.Label,{htmlFor:"diagnosis",children:"Diagnóstico"}),(0,b.jsx)(i.Textarea,{id:"diagnosis",name:"diagnosis",value:V.diagnosis,onChange:af})]}),(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)(h.Label,{htmlFor:"treatment",children:"Tratamiento"}),(0,b.jsx)(i.Textarea,{id:"treatment",name:"treatment",value:V.treatment,onChange:af})]}),(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)(h.Label,{htmlFor:"notes",children:"Notas Adicionales"}),(0,b.jsx)(i.Textarea,{id:"notes",name:"notes",value:V.notes,onChange:af})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"veterinarian",children:"Veterinario"}),(0,b.jsxs)(j.Select,{value:V.veterinarian,onValueChange:a=>W({...V,veterinarian:a}),children:[(0,b.jsx)(j.SelectTrigger,{children:(0,b.jsx)(j.SelectValue,{placeholder:"Seleccionar veterinario"})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"none",children:"Ninguno"}),F.map(a=>(0,b.jsxs)(j.SelectItem,{value:`${a.name} ${a.lastName}`,children:[a.name," ",a.lastName," - ",a.position]},a.id))]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"cost",children:"Costo"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:"$"}),(0,b.jsx)(g.Input,{id:"cost",name:"cost",value:V.cost,onChange:a=>{let b=(0,y.parseCurrency)(a.target.value);(""===b||/^\d*\.?\d{0,2}$/.test(b))&&W({...V,cost:b})},placeholder:"0.00",className:"pl-7"})]}),V.cost&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:(0,y.formatCurrency)(V.cost)})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(d.Button,{type:"button",variant:"outline",onClick:ad,children:"Cancelar"}),(0,b.jsx)(d.Button,{type:"submit",children:N?"Actualizar":"Guardar"})]})]})]})}),(0,b.jsx)(f.Dialog,{open:L,onOpenChange:M,children:(0,b.jsxs)(f.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)(f.DialogHeader,{children:(0,b.jsx)(f.DialogTitle,{children:"Registrar Nuevo Paciente"})}),(0,b.jsxs)("form",{onSubmit:ae,className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"name",children:"Nombre *"}),(0,b.jsx)(g.Input,{id:"name",value:X.name,onChange:a=>Y({...X,name:a.target.value}),required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"animalType",children:"Tipo de Animal *"}),(0,b.jsxs)(j.Select,{value:X.animalType,onValueChange:a=>Y({...X,animalType:a}),children:[(0,b.jsx)(j.SelectTrigger,{children:(0,b.jsx)(j.SelectValue,{placeholder:"Seleccionar"})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"Perro",children:"Perro"}),(0,b.jsx)(j.SelectItem,{value:"Gato",children:"Gato"}),(0,b.jsx)(j.SelectItem,{value:"Ave",children:"Ave"}),(0,b.jsx)(j.SelectItem,{value:"Conejo",children:"Conejo"}),(0,b.jsx)(j.SelectItem,{value:"Hamster",children:"Hámster"}),(0,b.jsx)(j.SelectItem,{value:"Reptil",children:"Reptil"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"breed",children:"Raza"}),(0,b.jsx)(g.Input,{id:"breed",value:X.breed,onChange:a=>Y({...X,breed:a.target.value})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"age",children:"Edad (años)"}),(0,b.jsx)(g.Input,{id:"age",value:X.age,onChange:a=>{(""===a.target.value||/^\d+$/.test(a.target.value))&&Y({...X,age:a.target.value})}})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"weight",children:"Peso (kg)"}),(0,b.jsx)(g.Input,{id:"weight",value:X.weight,onChange:a=>{(""===a.target.value||/^\d*\.?\d*$/.test(a.target.value))&&Y({...X,weight:a.target.value})}})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"sex",children:"Sexo"}),(0,b.jsxs)(j.Select,{value:X.sex,onValueChange:a=>Y({...X,sex:a}),children:[(0,b.jsx)(j.SelectTrigger,{children:(0,b.jsx)(j.SelectValue,{placeholder:"Seleccionar"})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"Macho",children:"Macho"}),(0,b.jsx)(j.SelectItem,{value:"Hembra",children:"Hembra"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"ownerName",children:"Nombre del Dueño *"}),(0,b.jsx)(g.Input,{id:"ownerName",value:X.ownerName,onChange:a=>Y({...X,ownerName:a.target.value}),required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"ownerPhone",children:"Teléfono del Dueño"}),(0,b.jsx)(g.Input,{id:"ownerPhone",value:X.ownerPhone,onChange:a=>Y({...X,ownerPhone:a.target.value})})]}),(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)(h.Label,{htmlFor:"medicalHistory",children:"Historial Médico"}),(0,b.jsx)(i.Textarea,{id:"medicalHistory",value:X.medicalHistory,onChange:a=>Y({...X,medicalHistory:a.target.value})})]}),(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)(h.Label,{htmlFor:"diseases",children:"Enfermedades"}),(0,b.jsx)(i.Textarea,{id:"diseases",value:X.diseases,onChange:a=>Y({...X,diseases:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(d.Button,{type:"button",variant:"outline",onClick:()=>M(!1),children:"Cancelar"}),(0,b.jsx)(d.Button,{type:"submit",children:"Guardar Paciente"})]})]})]})})]}):(0,b.jsx)("div",{className:"p-6",children:"Por favor selecciona un consultorio"})}a.s(["default",()=>z],1085)}];

//# sourceMappingURL=app_consultas_page_jsx_dfa3d3d3._.js.map