module.exports=[88830,a=>{"use strict";var b=a.i(87924),c=a.i(15618),d=a.i(40695),e=a.i(3130),f=a.i(5522),g=a.i(54161),h=a.i(87682),i=a.i(72131),j=a.i(87532),k=a.i(24569),l=a.i(81560),m=a.i(73570),n=a.i(83497),o=a.i(33508),p=a.i(65733),q=a.i(17171);function r({inventory:a,onAdd:c,onEdit:r,onDelete:s,filterCategory:t,onClearFilter:u}){let[v,w]=(0,i.useState)(""),[x,y]=(0,i.useState)("all"),[z,A]=(0,i.useState)(!1),[B,C]=(0,i.useState)(!1),[D,E]=(0,i.useState)(!1),[F,G]=(0,i.useState)(null),[H,I]=(0,i.useState)({name:"",category:"",stock:"",minStock:"",price:"",supplier:""}),J=(0,i.useMemo)(()=>{let b=a;if("lowStock"===t?b=b.filter(a=>a.stock<=a.minStock):"Medicamento"===t&&(b=b.filter(a=>"Medicamento"===a.category)),"all"!==x&&(b=b.filter(a=>a.category===x)),v){let a=v.toLowerCase();b=b.filter(b=>b.name.toLowerCase().includes(a)||b.category.toLowerCase().includes(a)||b.supplier.toLowerCase().includes(a)||b.id.toLowerCase().includes(a))}return b},[a,v,x,t]),K=()=>{I({name:"",category:"",stock:"",minStock:"",price:"",supplier:""})};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(e.CardTitle,{children:"Inventario de Productos"}),(0,b.jsx)(e.CardDescription,{children:"Medicamentos, alimentos y productos disponibles"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[t&&(0,b.jsxs)(d.Button,{variant:"outline",size:"sm",onClick:u,children:[(0,b.jsx)(o.X,{className:"h-4 w-4 mr-2"}),"Limpiar filtro"]}),(0,b.jsxs)(h.Select,{value:x,onValueChange:y,children:[(0,b.jsx)(h.SelectTrigger,{className:"w-40",children:(0,b.jsx)(h.SelectValue,{placeholder:"Categoría"})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"all",children:"Todas"}),(0,b.jsx)(h.SelectItem,{value:"Medicamento",children:"Medicamentos"}),(0,b.jsx)(h.SelectItem,{value:"Alimento",children:"Alimentos"}),(0,b.jsx)(h.SelectItem,{value:"Producto",children:"Productos"}),(0,b.jsx)(h.SelectItem,{value:"Servicio",children:"Servicios"})]})]}),(0,b.jsxs)("div",{className:"relative w-64",children:[(0,b.jsx)(j.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(f.Input,{type:"search",placeholder:"Buscar productos...",className:"pl-10",value:v,onChange:a=>w(a.target.value)})]})]})]})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"rounded-lg border border-border overflow-hidden",children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-muted/50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"ID"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Producto"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Categoría"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Stock"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Precio"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Proveedor"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Estado"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted-foreground",children:"Acciones"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-border",children:J.map(a=>{var c,e;let f=(c=a.stock,e=a.minStock,0===c?{label:"Agotado",variant:"destructive",alert:!0}:c<=e?{label:"Stock Bajo",variant:"secondary",alert:!0}:{label:"Disponible",variant:"default",alert:!1}),h=a.stock/(3*a.minStock)*100;return(0,b.jsxs)("tr",{className:"hover:bg-muted/30 transition-colors",children:[(0,b.jsx)("td",{className:"px-4 py-3 text-sm font-mono text-muted-foreground",children:a.id}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(n.Package,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:a.name}),"Medicamento"===a.category&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[a.medicationType," - ",a.dosage]}),"Alimento"===a.category&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[a.foodType," - ",a.weight]})]})]})}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsx)(g.Badge,{variant:"outline",children:a.category})}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("p",{className:"text-sm font-medium",children:[a.stock," unidades"]}),f.alert&&(0,b.jsx)(m.AlertTriangle,{className:"h-3 w-3 text-orange-500"})]}),(0,b.jsx)("div",{className:"w-24 h-1.5 bg-muted rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:`h-full ${h>50?"bg-green-500":h>20?"bg-orange-500":"bg-red-500"}`,style:{width:`${Math.min(h,100)}%`}})}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Mín: ",a.minStock]})]})}),(0,b.jsxs)("td",{className:"px-4 py-3",children:[(0,b.jsxs)("p",{className:"text-sm font-medium",children:["$",a.price.toLocaleString()]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Total: $",(a.stock*a.price).toLocaleString()]})]}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsx)("p",{className:"text-sm",children:a.supplier})}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsx)(g.Badge,{variant:f.variant,children:f.label})}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(d.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{G(a),I({name:a.name,category:a.category,stock:a.stock.toString(),minStock:a.minStock.toString(),price:a.price.toString(),supplier:a.supplier}),C(!0)},children:(0,b.jsx)(k.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(d.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>{G(a),E(!0)},children:(0,b.jsx)(l.Trash2,{className:"h-4 w-4"})})]})})]},a.id)})})]})})}),0===J.length&&(0,b.jsx)("div",{className:"text-center py-12",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"No se encontraron productos"})}),(0,b.jsxs)("div",{className:"mt-4 flex items-center justify-between text-sm text-muted-foreground",children:[(0,b.jsxs)("p",{children:["Mostrando ",J.length," de ",a.length," productos"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(m.AlertTriangle,{className:"h-4 w-4 text-orange-500"}),(0,b.jsxs)("span",{children:[J.filter(a=>a.stock<=a.minStock).length," productos con stock bajo"]})]})]})]})]}),(0,b.jsx)(p.Dialog,{open:z||B,onOpenChange:a=>{a||(A(!1),C(!1),K(),G(null))},children:(0,b.jsxs)(p.DialogContent,{className:"max-w-2xl",children:[(0,b.jsxs)(p.DialogHeader,{children:[(0,b.jsx)(p.DialogTitle,{children:z?"Nuevo Producto":"Editar Producto"}),(0,b.jsx)(p.DialogDescription,{children:z?"Complete los datos del nuevo producto":"Modifique los datos del producto"})]}),(0,b.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(q.Label,{htmlFor:"name",children:["Nombre del Producto ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(f.Input,{id:"name",value:H.name,onChange:a=>I({...H,name:a.target.value}),placeholder:"Ej: Vacuna Antirrábica"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(q.Label,{htmlFor:"category",children:["Categoría ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsxs)(h.Select,{value:H.category,onValueChange:a=>I({...H,category:a}),children:[(0,b.jsx)(h.SelectTrigger,{children:(0,b.jsx)(h.SelectValue,{placeholder:"Seleccione"})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"Medicamento",children:"Medicamento"}),(0,b.jsx)(h.SelectItem,{value:"Alimento",children:"Alimento"}),(0,b.jsx)(h.SelectItem,{value:"Producto",children:"Producto"}),(0,b.jsx)(h.SelectItem,{value:"Servicio",children:"Servicio"})]})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(q.Label,{htmlFor:"stock",children:["Stock Actual ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(f.Input,{id:"stock",type:"number",min:"0",value:H.stock,onChange:a=>I({...H,stock:a.target.value}),onKeyPress:a=>{/[0-9]/.test(a.key)||a.preventDefault()},placeholder:"Ej: 50"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(q.Label,{htmlFor:"minStock",children:["Stock Mínimo ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(f.Input,{id:"minStock",type:"number",min:"0",value:H.minStock,onChange:a=>I({...H,minStock:a.target.value}),onKeyPress:a=>{/[0-9]/.test(a.key)||a.preventDefault()},placeholder:"Ej: 10"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(q.Label,{htmlFor:"price",children:["Precio ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(f.Input,{id:"price",type:"number",min:"0",value:H.price,onChange:a=>I({...H,price:a.target.value}),onKeyPress:a=>{/[0-9]/.test(a.key)||a.preventDefault()},placeholder:"Ej: 250"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(q.Label,{htmlFor:"supplier",children:["Proveedor ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(f.Input,{id:"supplier",value:H.supplier,onChange:a=>I({...H,supplier:a.target.value}),placeholder:"Ej: Farmacia Veterinaria SA"})]})]}),(0,b.jsxs)(p.DialogFooter,{children:[(0,b.jsx)(d.Button,{variant:"outline",onClick:()=>{A(!1),C(!1),K(),G(null)},children:"Cancelar"}),(0,b.jsx)(d.Button,{onClick:z?()=>{H.name&&H.category&&H.stock&&H.minStock&&H.price&&H.supplier?(c({id:`INV-${Math.floor(9e3*Math.random())+1e3}`,...H,stock:Number.parseInt(H.stock),minStock:Number.parseInt(H.minStock),price:Number.parseInt(H.price)}),A(!1),K()):alert("Por favor complete todos los campos obligatorios")}:()=>{H.name&&H.category&&H.stock&&H.minStock&&H.price&&H.supplier?(r({...F,...H,stock:Number.parseInt(H.stock),minStock:Number.parseInt(H.minStock),price:Number.parseInt(H.price)}),C(!1),K(),G(null)):alert("Por favor complete todos los campos obligatorios")},children:z?"Agregar":"Guardar Cambios"})]})]})}),(0,b.jsx)(p.Dialog,{open:D,onOpenChange:E,children:(0,b.jsxs)(p.DialogContent,{children:[(0,b.jsxs)(p.DialogHeader,{children:[(0,b.jsx)(p.DialogTitle,{children:"Confirmar Eliminación"}),(0,b.jsxs)(p.DialogDescription,{children:["¿Está seguro que desea eliminar el producto ",(0,b.jsx)("strong",{children:F?.name}),"? Esta acción no se puede deshacer."]})]}),(0,b.jsxs)(p.DialogFooter,{children:[(0,b.jsx)(d.Button,{variant:"outline",onClick:()=>E(!1),children:"Cancelar"}),(0,b.jsx)(d.Button,{variant:"destructive",onClick:()=>{F&&(s(F.id),E(!1),G(null))},children:"Eliminar"})]})]})})]})}var s=a.i(17493),t=a.i(46893),u=a.i(3183),v=a.i(19966),w=a.i(1484),x=a.i(90166),y=a.i(24669),z=a.i(86297);function A(){let{getUserId:a,getClinicId:e}=(0,u.useAuth)(),{showSuccess:g,showError:j,showWarning:k,showInfo:l,AlertContainer:o}=(0,w.useAlertToast)(),[A,B]=(0,i.useState)([]),[C,D]=(0,i.useState)([]),[E,F]=(0,i.useState)([]),[G,H]=(0,i.useState)(!0),[I,J]=(0,i.useState)(!1),[K,L]=(0,i.useState)(null),[M,N]=(0,i.useState)(null),[O,P]=(0,i.useState)({name:"",category:"",quantity:"",price:"",supplier:"",expiryDate:"",description:""});(0,i.useEffect)(()=>{let b=a(),c=e();b&&c&&(Q(),R())},[a,e]);let Q=async()=>{try{H(!0);let b=a(),c=e(),d=await fetch(`/api/inventory?userId=${b}&clinicId=${c}`),f=await d.json();f.success?(B(f.data),D(f.data)):j(f.error||"Error al cargar el inventario")}catch(a){console.error("Error fetching inventory:",a),j("Error al cargar el inventario")}finally{H(!1)}},R=async()=>{try{let a=await fetch("/api/item-categories"),b=await a.json();b.success?F(b.data):k("No se pudieron cargar las categorías")}catch(a){console.error("Error fetching categories:",a)}},S=async b=>{if(confirm("¿Estás seguro de eliminar este producto?"))try{let c=a(),d=e(),f=await fetch(`/api/inventory?id=${b}&userId=${c}&clinicId=${d}`,{method:"DELETE"}),h=await f.json();h.success?(g("Producto eliminado exitosamente"),await Q()):j(h.error||"Error al eliminar el producto")}catch(a){console.error("Error deleting item:",a),j("Error al eliminar el producto")}},T=async b=>{if(b.preventDefault(),!O.name||!O.category||!O.quantity)return void k("Por favor completa todos los campos requeridos");try{let b=K?"PUT":"POST",c=a(),d=e(),f=K?{name:O.name,categoryId:O.category,stock:O.quantity,price:O.price,supplier:O.supplier,expiryDate:O.expiryDate,description:O.description,id:K.id,userId:c,clinicId:d}:{name:O.name,categoryId:O.category,stock:O.quantity,price:O.price,supplier:O.supplier,expiryDate:O.expiryDate,description:O.description,userId:c,clinicId:d},h=await fetch("/api/inventory",{method:b,headers:{"Content-Type":"application/json"},body:JSON.stringify(f)}),i=await h.json();i.success?(g(K?"Producto actualizado exitosamente":"Producto agregado exitosamente"),J(!1),await Q()):j(i.error||"Error al guardar el producto")}catch(a){console.error("Error saving item:",a),j("Error al guardar el producto")}},U=(a,b)=>{P(c=>({...c,[a]:b}))},V=a=>{N(a),"lowStock"===a?D(A.filter(a=>a.stock<=(a.minStock||10))):a?D(A.filter(b=>b.category===a)):D(A)};if(G)return(0,b.jsx)(v.LoadingPage,{message:"Cargando inventario..."});let W=a(),X=e();if(!W||!X)return(0,b.jsx)("div",{className:"p-8",children:"Por favor selecciona un consultorio"});let Y=A.length,Z=A.filter(a=>a.stock<=(a.minStock||10)).length,$=A.reduce((a,b)=>a+(Number.parseFloat(b.price)||0)*(b.stock||0),0);return(0,b.jsxs)("div",{className:"p-8",children:[(0,b.jsx)(o,{}),(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"Inventario"}),(0,b.jsxs)(d.Button,{onClick:()=>{L(null),P({name:"",category:"",quantity:"",price:"",supplier:"",expiryDate:"",description:""}),J(!0)},className:"btn-primary",children:[(0,b.jsx)(c.Plus,{className:"w-4 h-4 mr-2"}),"Nuevo Producto"]})]}),(0,b.jsxs)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[(0,b.jsx)(s.StatsCard,{title:"Total de Productos",subtitle:"Artículos en stock",value:Y,icon:n.Package,trend:{value:0,isPositive:!0},onClick:()=>V(null),isActive:null===M}),(0,b.jsx)(s.StatsCard,{title:"Stock Bajo",subtitle:"Requieren reabastecimiento",value:Z,icon:m.AlertTriangle,trend:{value:0,isPositive:!1},onClick:()=>V("lowStock"),isActive:"lowStock"===M,variant:"warning"}),(0,b.jsx)(s.StatsCard,{title:"Valor Total",subtitle:"Inventario valorizado",value:(0,z.formatCurrency)($),icon:x.DollarSign,trend:{value:0,isPositive:!0}}),(0,b.jsx)(s.StatsCard,{title:"Valor Promedio",subtitle:"Por artículo",value:(0,z.formatCurrency)(Y>0?$/Y:0),icon:y.TrendingUp,trend:{value:0,isPositive:!0}})]}),(0,b.jsx)(r,{inventory:C,onEdit:a=>{L(a),P({name:a.name||"",category:a.categoryId?.toString()||"",quantity:a.stock||"",price:a.price||"",supplier:a.supplier||"",expiryDate:a.expiryDate||"",description:a.description||""}),J(!0)},onDelete:S,onSearch:a=>{D(A.filter(b=>(b.name?.toLowerCase()||"").includes(a.toLowerCase())||(b.category?.toLowerCase()||"").includes(a.toLowerCase())||(b.supplier?.toLowerCase()||"").includes(a.toLowerCase())))}}),(0,b.jsx)(p.Dialog,{open:I,onOpenChange:J,children:(0,b.jsxs)(p.DialogContent,{className:"max-w-2xl",children:[(0,b.jsx)(p.DialogHeader,{children:(0,b.jsx)(p.DialogTitle,{children:K?"Editar Producto":"Agregar Nuevo Producto"})}),(0,b.jsxs)("form",{onSubmit:T,className:"grid gap-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(q.Label,{htmlFor:"name",children:"Nombre *"}),(0,b.jsx)(f.Input,{id:"name",value:O.name,onChange:a=>U("name",a.target.value),required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(q.Label,{htmlFor:"category",children:"Categoría *"}),(0,b.jsxs)(h.Select,{value:O.category,onValueChange:a=>U("category",a),children:[(0,b.jsx)(h.SelectTrigger,{children:(0,b.jsx)(h.SelectValue,{placeholder:"Seleccionar"})}),(0,b.jsx)(h.SelectContent,{children:E.map(a=>(0,b.jsx)(h.SelectItem,{value:a.id.toString(),children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(q.Label,{htmlFor:"quantity",children:"Cantidad *"}),(0,b.jsx)(f.Input,{id:"quantity",type:"number",value:O.quantity,onChange:a=>U("quantity",a.target.value),onKeyPress:a=>{/[0-9]/.test(a.key)||a.preventDefault()},required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(q.Label,{htmlFor:"price",children:"Precio"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:"$"}),(0,b.jsx)(f.Input,{id:"price",value:O.price,onChange:a=>{var b;let c;return b=a.target.value,void((""===(c=(0,z.parseCurrency)(b))||/^\d*\.?\d{0,2}$/.test(c))&&U("price",c))},placeholder:"0.00",className:"pl-7"})]}),O.price&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:(0,z.formatCurrency)(O.price)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(q.Label,{htmlFor:"supplier",children:"Proveedor"}),(0,b.jsx)(f.Input,{id:"supplier",value:O.supplier,onChange:a=>U("supplier",a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(q.Label,{htmlFor:"expiryDate",children:"Fecha de Vencimiento"}),(0,b.jsx)(f.Input,{id:"expiryDate",type:"date",value:O.expiryDate,onChange:a=>U("expiryDate",a.target.value)})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(q.Label,{htmlFor:"description",children:"Descripción"}),(0,b.jsx)(t.Textarea,{id:"description",value:O.description,onChange:a=>U("description",a.target.value),rows:3})]}),(0,b.jsxs)(p.DialogFooter,{children:[(0,b.jsx)(d.Button,{type:"button",variant:"outline",onClick:()=>J(!1),children:"Cancelar"}),(0,b.jsx)(d.Button,{type:"submit",className:"btn-primary",children:K?"Actualizar":"Guardar"})]})]})]})})]})}a.s(["default",()=>A],88830)}];

//# sourceMappingURL=app_inventario_page_jsx_0efbe470._.js.map